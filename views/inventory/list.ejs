<div class="page-header">
    <div style="display: flex; justify-content: space-between; align-items: center;">
        <div>
            <h1 class="page-title">Ù…Ø¯ÛŒØ±ÛŒØª Ø§Ù†Ø¨Ø§Ø±</h1>
            <p>Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ùˆ Ù…Ø¯ÛŒØ±ÛŒØª Ú©Ø§Ù„Ø§Ù‡Ø§ÛŒ Ù…ÙˆØ¬ÙˆØ¯ Ø¯Ø± Ø§Ù†Ø¨Ø§Ø±</p>
        </div>
        <div style="display: flex; gap: 10px;">
            <a href="/inventory/categories" class="btn btn-primary">
                ğŸ“ Ù…Ø¯ÛŒØ±ÛŒØª Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒâ€ŒÙ‡Ø§
            </a>
            <a href="/inventory/add" class="btn btn-success">
                â• Ø§ÙØ²ÙˆØ¯Ù† Ú©Ø§Ù„Ø§ÛŒ Ø¬Ø¯ÛŒØ¯
            </a>
        </div>
    </div>
</div>

<!-- Search and Filters -->
<div class="search-filters">
    <div class="filters-row">
        <div class="form-group">
            <label class="form-label">Ø¬Ø³ØªØ¬Ùˆ Ø¯Ø± Ù†Ø§Ù… Ú©Ø§Ù„Ø§</label>
            <input type="text" id="searchInput" class="form-control" placeholder="Ù†Ø§Ù… Ú©Ø§Ù„Ø§ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯...">
        </div>
        <div class="form-group">
            <label class="form-label">Ù†ÙˆØ¹ Ú©Ø§Ù„Ø§</label>
            <select id="typeFilter" class="form-control">
                <option value="">Ù‡Ù…Ù‡ Ø§Ù†ÙˆØ§Ø¹</option>
                <% types.forEach(type => { %>
                    <option value="<%= type.category_name %>"><%= type.category_name %></option>
                <% }) %>
            </select>
        </div>
        <div class="form-group">
            <label class="form-label">Ø¹ÛŒØ§Ø±</label>
            <select id="caratFilter" class="form-control">
                <option value="">Ù‡Ù…Ù‡ Ø¹ÛŒØ§Ø±Ù‡Ø§</option>
                <option value="18">18 Ø¹ÛŒØ§Ø±</option>
                <option value="21">21 Ø¹ÛŒØ§Ø±</option>
                <option value="24">24 Ø¹ÛŒØ§Ø±</option>
            </select>
        </div>
        <div class="form-group">
            <button type="button" class="btn btn-secondary" onclick="clearFilters()">
                Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† ÙÛŒÙ„ØªØ±Ù‡Ø§
            </button>
        </div>
    </div>
</div>

<!-- Inventory Table -->
<div class="table-container">
    <table class="table" id="inventoryTable">
        <thead>
            <tr>
                <th>ØªØµÙˆÛŒØ±</th>
                <th>Ú©Ø¯ Ú©Ø§Ù„Ø§</th>
                <th>Ù†Ø§Ù… Ú©Ø§Ù„Ø§</th>
                <th>Ù†ÙˆØ¹</th>
                <th>Ø¹ÛŒØ§Ø±</th>
                <th>Ù…ÙˆØ¬ÙˆØ¯ÛŒ</th>
                <th>Ø¹Ù…Ù„ÛŒØ§Øª</th>
            </tr>
        </thead>
        <tbody>
            <% if (items && items.length > 0) { %>
                <% items.forEach(item => { %>
                    <tr>
                        <td>
                            <% if (item.image_path) { %>
                                <img src="<%= item.image_path %>" alt="<%= item.item_name %>">
                            <% } else { %>
                                <div style="width: 50px; height: 50px; background: #f0f0f0; border-radius: 5px; display: flex; align-items: center; justify-content: center;">
                                    <span style="color: #999;">Ø¨Ø¯ÙˆÙ† ØªØµÙˆÛŒØ±</span>
                                </div>
                            <% } %>
                        </td>
                        <td><strong><%= item.item_code %></strong></td>
                        <td><%= item.item_name %></td>
                        <td><%= item.type_name %></td>
                        <td><%= item.carat %> Ø¹ÛŒØ§Ø±</td>
                        <td>
                            <span class="<%= item.current_quantity > 0 ? 'text-success' : 'text-danger' %>">
                                <%= item.current_quantity %>
                            </span>
                        </td>
                        <td>
                            <a href="/inventory/view/<%= item.id %>" class="btn btn-sm btn-primary">
                                Ù…Ø´Ø§Ù‡Ø¯Ù‡
                            </a>
                            <a href="/inventory/edit/<%= item.id %>" class="btn btn-sm btn-secondary">
                                ÙˆÛŒØ±Ø§ÛŒØ´
                            </a>
                            <button onclick="deleteItem('<%= item.id %>', '<%= item.item_code %>')" 
                                    class="btn btn-sm btn-danger" data-item-name="<%= item.item_name %>">
                                Ø­Ø°Ù
                            </button>
                        </td>
                    </tr>
                <% }) %>
            <% } else { %>
                <tr>
                    <td colspan="7" style="text-align: center; padding: 40px; color: #666;">
                        Ù‡ÛŒÚ† Ú©Ø§Ù„Ø§ÛŒÛŒ Ø¯Ø± Ø§Ù†Ø¨Ø§Ø± Ù…ÙˆØ¬ÙˆØ¯ Ù†ÛŒØ³Øª
                    </td>
                </tr>
            <% } %>
        </tbody>
    </table>
</div>

<script>
// Search and filter functionality
document.getElementById('searchInput').addEventListener('input', filterTable);
document.getElementById('typeFilter').addEventListener('change', filterTable);
document.getElementById('caratFilter').addEventListener('change', filterTable);

function filterTable() {
    const searchTerm = document.getElementById('searchInput').value.toLowerCase();
    const typeFilter = document.getElementById('typeFilter').value;
    const caratFilter = document.getElementById('caratFilter').value;
    
    const table = document.getElementById('inventoryTable');
    const rows = table.getElementsByTagName('tbody')[0].getElementsByTagName('tr');
    
    for (let i = 0; i < rows.length; i++) {
        const row = rows[i];
        const name = row.cells[2].textContent.toLowerCase();
        const type = row.cells[3].textContent;
        const carat = row.cells[4].textContent;
        
        let showRow = true;
        
        if (searchTerm && !name.includes(searchTerm)) {
            showRow = false;
        }
        
        if (typeFilter && !type.includes(typeFilter)) {
            showRow = false;
        }
        
        if (caratFilter && !carat.includes(caratFilter)) {
            showRow = false;
        }
        
        row.style.display = showRow ? '' : 'none';
    }
}

function clearFilters() {
    document.getElementById('searchInput').value = '';
    document.getElementById('typeFilter').value = '';
    document.getElementById('caratFilter').value = '';
    filterTable();
}

// Delete item function
async function deleteItem(itemId, itemCode) {
    const button = event.target;
    const itemName = button.getAttribute('data-item-name');
    
    // Confirm deletion
    if (!confirm(`Ø¢ÛŒØ§ Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ Ú©Ù‡ Ù…ÛŒâ€ŒØ®ÙˆØ§Ù‡ÛŒØ¯ Ú©Ø§Ù„Ø§ÛŒ "${itemName}" (Ú©Ø¯: ${itemCode}) Ø±Ø§ Ø­Ø°Ù Ú©Ù†ÛŒØ¯ØŸ\n\nØªÙˆØ¬Ù‡: Ø§Ú¯Ø± Ø§ÛŒÙ† Ú©Ø§Ù„Ø§ Ù‚Ø¨Ù„Ø§Ù‹ ÙØ±ÙˆØ®ØªÙ‡ Ø´Ø¯Ù‡ Ø¨Ø§Ø´Ø¯ØŒ Ù‚Ø§Ø¨Ù„ Ø­Ø°Ù Ù†Ø®ÙˆØ§Ù‡Ø¯ Ø¨ÙˆØ¯.`)) {
        return;
    }
    
    // Disable button during request
    button.disabled = true;
    button.textContent = 'Ø¯Ø± Ø­Ø§Ù„ Ø­Ø°Ù...';
    
    try {
        const response = await fetch(`/inventory/delete/${itemId}`, {
            method: 'DELETE',
            headers: {
                'Content-Type': 'application/json',
            }
        });
        
        const result = await response.json();
        
        if (result.success) {
            // Show success message
            alert(result.message);
            // Reload page to update the list
            window.location.reload();
        } else {
            // Show error message
            alert('Ø®Ø·Ø§: ' + result.message);
            // Re-enable button
            button.disabled = false;
            button.textContent = 'Ø­Ø°Ù';
        }
        
    } catch (error) {
        console.error('Delete error:', error);
        alert('Ø®Ø·Ø§ Ø¯Ø± Ø­Ø°Ù Ú©Ø§Ù„Ø§. Ù„Ø·ÙØ§Ù‹ Ø¯ÙˆØ¨Ø§Ø±Ù‡ ØªÙ„Ø§Ø´ Ú©Ù†ÛŒØ¯.');
        // Re-enable button
        button.disabled = false;
        button.textContent = 'Ø­Ø°Ù';
    }
}
</script>

<style>
.btn-danger {
    background-color: #dc3545;
    color: white;
    border: 1px solid #dc3545;
}

.btn-danger:hover {
    background-color: #c82333;
    border-color: #bd2130;
}

.btn-danger:disabled {
    background-color: #6c757d;
    border-color: #6c757d;
    cursor: not-allowed;
}

.btn-sm {
    padding: 4px 8px;
    font-size: 12px;
    margin: 2px;
}
</style> 