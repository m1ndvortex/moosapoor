<div class="page-header">
    <h1 class="page-title">ูุฑุงุด ุฏุณุชูโุจูุฏ</h1>
    <p>ูุฑุงุด ุงุทูุงุนุงุช ุฏุณุชูโุจูุฏ "<%= category.name_persian %>"</p>
</div>

<div class="card">
    <div class="card-header">
        ุงุทูุงุนุงุช ุฏุณุชูโุจูุฏ
    </div>
    <div class="card-body">
        <form action="/inventory/categories/update/<%= category.id %>" method="POST">
            <div class="row">
                <!-- Category Info -->
                <div class="col-md-12">
                    <div class="alert alert-info">
                        <strong>ููุน ุฏุณุชูโุจูุฏ:</strong>
                        <% if (category.parent_id) { %>
                            ๐ ุฒุฑูุฌููุนู ุงุฒ "<%= parentCategories.find(p => p.id == category.parent_id)?.name_persian || 'ูุงูุดุฎุต' %>"
                        <% } else { %>
                            ๐ ุฏุณุชูโุจูุฏ ุงุตู
                        <% } %>
                    </div>
                </div>
                
                <!-- Parent Category (for subcategories only) -->
                <% if (!category.parent_id) { %>
                    <div class="col-md-12">
                        <div class="form-group">
                            <label for="parent_id" class="form-label">ุชุจุฏู ุจู ุฒุฑูุฌููุนู</label>
                            <select name="parent_id" id="parent_id" class="form-control">
                                <option value="">ูฺฏู ุฏุงุดุชู ุจู ุนููุงู ุฏุณุชูโุจูุฏ ุงุตู</option>
                                <% parentCategories.forEach(parent => { %>
                                    <option value="<%= parent.id %>">
                                        ุชุจุฏู ุจู ุฒุฑูุฌููุนู "<%= parent.name_persian %>"
                                    </option>
                                <% }); %>
                            </select>
                            <small class="form-text text-muted">
                                ููุท ุฏุฑ ุตูุฑุช ุนุฏู ูุฌูุฏ ุฒุฑูุฌููุนู ูุงุจู ุงูุฌุงู ุงุณุช
                            </small>
                        </div>
                    </div>
                <% } else { %>
                    <div class="col-md-12">
                        <div class="form-group">
                            <label for="parent_id" class="form-label">ุฏุณุชูโุจูุฏ ูุงูุฏ</label>
                            <select name="parent_id" id="parent_id" class="form-control">
                                <option value="">ุชุจุฏู ุจู ุฏุณุชูโุจูุฏ ุงุตู</option>
                                <% parentCategories.forEach(parent => { %>
                                    <option value="<%= parent.id %>" 
                                            <%= (category.parent_id == parent.id) ? 'selected' : '' %>>
                                        <%= parent.name_persian %> (<%= parent.name %>)
                                    </option>
                                <% }); %>
                            </select>
                        </div>
                    </div>
                <% } %>
                
                <!-- Persian Name -->
                <div class="col-md-6">
                    <div class="form-group">
                        <label for="name_persian" class="form-label">ูุงู ูุงุฑุณ *</label>
                        <input type="text" name="name_persian" id="name_persian" 
                               class="form-control" required
                               value="<%= category.name_persian %>"
                               placeholder="ูุซุงู: ุงูฺฏุดุชุฑุ ฺฏุฑุฏูุจูุฏุ ุณฺฉู ุชูุงู">
                        <small class="form-text text-muted">
                            ูุงู ููุงุด ุฏุณุชูโุจูุฏ ุจู ูุงุฑุณ
                        </small>
                    </div>
                </div>
                
                <!-- English Name -->
                <div class="col-md-6">
                    <div class="form-group">
                        <label for="name" class="form-label">ูุงู ุงูฺฏูุณ *</label>
                        <input type="text" name="name" id="name" 
                               class="form-control" required
                               value="<%= category.name %>"
                               placeholder="rings, necklaces, full_coins"
                               pattern="[a-z_]+" 
                               title="ููุท ุญุฑูู ฺฉูฺฺฉ ุงูฺฏูุณ ู underscore">
                        <small class="form-text text-muted">
                            ูุงู ุชฺฉูฺฉ (ููุท ุญุฑูู ฺฉูฺฺฉ ุงูฺฏูุณ ู _)
                        </small>
                    </div>
                </div>
                
                <!-- Description -->
                <div class="col-md-12">
                    <div class="form-group">
                        <label for="description" class="form-label">ุชูุถุญุงุช</label>
                        <textarea name="description" id="description" 
                                  class="form-control" rows="3"
                                  placeholder="ุชูุถุญ ูุฎุชุตุฑ ุฏุฑ ููุฑุฏ ุงู ุฏุณุชูโุจูุฏ..."><%= category.description || '' %></textarea>
                    </div>
                </div>
                
                <!-- Sort Order -->
                <div class="col-md-6">
                    <div class="form-group">
                        <label for="sort_order" class="form-label">ุชุฑุชุจ ููุงุด</label>
                        <input type="number" name="sort_order" id="sort_order" 
                               class="form-control" value="<%= category.sort_order || 0 %>" 
                               min="0" max="999">
                        <small class="form-text text-muted">
                            ุนุฏุฏ ฺฉูุชุฑ = ููุงุด ุฏุฑ ุงุจุชุฏุง ูุณุช
                        </small>
                    </div>
                </div>
                
                <!-- Status -->
                <div class="col-md-6">
                    <div class="form-group">
                        <label class="form-label">ูุถุนุช</label>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" 
                                   name="is_active" id="is_active" 
                                   <%= category.is_active ? 'checked' : '' %>>
                            <label class="form-check-label" for="is_active">
                                ูุนุงู (ูุงุจู ุงุณุชูุงุฏู ุฏุฑ ุงูุฒูุฏู ฺฉุงูุง)
                            </label>
                        </div>
                        <small class="form-text text-muted">
                            ุบุฑูุนุงู ฺฉุฑุฏู ุฏุณุชูโุจูุฏ ุจุงุนุซ ุนุฏู ููุงุด ุขู ุฏุฑ ูุฑูโูุง ูโุดูุฏ
                        </small>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div style="border-top: 1px solid #dee2e6; padding-top: 20px; margin-top: 20px;">
                <button type="submit" class="btn btn-success">
                    โ ุจุฑูุฒุฑุณุงู ุฏุณุชูโุจูุฏ
                </button>
                <a href="/inventory/categories" class="btn btn-secondary">
                    ุงูุตุฑุงู
                </a>
                <button type="button" class="btn btn-outline-danger" 
                        onclick="confirmDelete(<%= category.id %>, '<%= category.name_persian %>')">
                    ๐๏ธ ุญุฐู ุฏุณุชูโุจูุฏ
                </button>
            </div>
        </form>
    </div>
</div>

<!-- Current Usage Info -->
<div class="card">
    <div class="card-header">
        ูุถุนุช ุงุณุชูุงุฏู
    </div>
    <div class="card-body">
        <div class="row">
            <div class="col-md-4">
                <div class="stat-card">
                    <div class="stat-number">-</div>
                    <div class="stat-label">ฺฉุงูุงูุง ูุฑุชุจุท</div>
                    <div class="stat-icon" style="color: #007bff;">๐ท๏ธ</div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="stat-card">
                    <div class="stat-number">-</div>
                    <div class="stat-label">ุฒุฑูุฌููุนูโูุง</div>
                    <div class="stat-icon" style="color: #28a745;">๐</div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="stat-card">
                    <div class="stat-number">
                        <span class="badge <%= category.is_active ? 'badge-success' : 'badge-secondary' %>">
                            <%= category.is_active ? 'ูุนุงู' : 'ุบุฑูุนุงู' %>
                        </span>
                    </div>
                    <div class="stat-label">ูุถุนุช</div>
                    <div class="stat-icon" style="color: #ffc107;">โ๏ธ</div>
                </div>
            </div>
        </div>
        
        <div class="alert alert-warning">
            <strong>ุชูุฌู:</strong> 
            <ul class="mb-0">
                <li>ุชุบุฑ ูุงู ุงูฺฏูุณ ููฺฉู ุงุณุช ุจุฑ ุณุณุชู ุชุฃุซุฑ ุจฺฏุฐุงุฑุฏ</li>
                <li>ุฏุณุชูโุจูุฏโูุง ฺฉู ุฏุงุฑุง ฺฉุงูุง ุง ุฒุฑูุฌููุนู ูุณุชูุฏ ูุงุจู ุญุฐู ูุณุชูุฏ</li>
                <li>ุบุฑูุนุงู ฺฉุฑุฏู ุฏุณุชูโุจูุฏ ฺฉุงูุงูุง ููุฌูุฏ ุฑุง ุญุฐู ููโฺฉูุฏ</li>
            </ul>
        </div>
    </div>
</div>

<!-- Delete Confirmation Modal -->
<div class="modal fade" id="deleteModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">ุชุฃุฏ ุญุฐู</h5>
                <button type="button" class="close" data-dismiss="modal">&times;</button>
            </div>
            <div class="modal-body">
                <p>ุขุง ูุทูุฆู ูุณุชุฏ ฺฉู ูโุฎูุงูุฏ ุฏุณุชูโุจูุฏ "<span id="deleteCategoryName"></span>" ุฑุง ุญุฐู ฺฉูุฏุ</p>
                <div class="alert alert-danger">
                    <strong>ูุดุฏุงุฑ:</strong> ุงู ุนูู ูุงุจู ุจุฑฺฏุดุช ูุณุช!
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">ุงูุตุฑุงู</button>
                <form id="deleteForm" method="POST" style="display: inline;">
                    <button type="submit" class="btn btn-danger">ุญุฐู ฺฉู</button>
                </form>
            </div>
        </div>
    </div>
</div>

<script>
function confirmDelete(categoryId, categoryName) {
    document.getElementById('deleteCategoryName').textContent = categoryName;
    document.getElementById('deleteForm').action = '/inventory/categories/delete/' + categoryId;
    $('#deleteModal').modal('show');
}

// Load current usage stats
window.addEventListener('load', function() {
    fetch('/inventory/categories/stats/<%= category.id %>')
        .then(response => response.json())
        .then(data => {
            document.querySelector('.stat-card:nth-child(1) .stat-number').textContent = data.items_count || 0;
            document.querySelector('.stat-card:nth-child(2) .stat-number').textContent = data.subcategories_count || 0;
        })
        .catch(error => console.log('Stats loading failed:', error));
});
</script> 