<!-- Ø§Ø³ØªØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ø§Ø®ØªØµØ§ØµÛŒ ÙØ±Ù… Ù…Ø´ØªØ±ÛŒ -->
<style>
.customer-form-container {
    font-family: 'IRANSans', 'Tahoma', sans-serif;
    max-width: 1200px;
    margin: 0 auto;
}

.page-header-enhanced {
    background: linear-gradient(135deg, #b8860b 0%, #daa520 100%);
    color: #2c2c2c;
    padding: 25px;
    border-radius: 10px;
    margin-bottom: 25px;
    text-align: center;
    box-shadow: 0 4px 15px rgba(184, 134, 11, 0.2);
}

.page-header-enhanced h1 {
    margin: 0 0 8px 0;
    font-size: 2em;
    font-weight: bold;
}

.page-header-enhanced p {
    margin: 0;
    opacity: 0.8;
    font-size: 1.1em;
}

.form-sections {
    display: grid;
    gap: 20px;
}

.form-section {
    background: white;
    border: 1px solid #d4c5a0;
    border-radius: 10px;
    overflow: hidden;
    box-shadow: 0 3px 12px rgba(184, 134, 11, 0.1);
    transition: transform 0.2s ease, box-shadow 0.2s ease;
}

.form-section:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(184, 134, 11, 0.15);
}

.section-header {
    background: linear-gradient(135deg, #b8860b 0%, #daa520 100%);
    color: #2c2c2c;
    padding: 15px 20px;
    border-bottom: 1px solid rgba(0,0,0,0.1);
}

.section-header h3 {
    margin: 0;
    font-size: 1.2em;
    font-weight: bold;
    display: flex;
    align-items: center;
    gap: 10px;
}

.section-body {
    padding: 25px;
}

.form-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: 20px;
}

.form-group {
    position: relative;
}

.form-label {
    display: block;
    margin-bottom: 8px;
    font-weight: 600;
    color: #2c2c2c;
    font-size: 0.95em;
}

.form-label.required::after {
    content: ' *';
    color: #dc3545;
    font-weight: bold;
}

.form-control {
    width: 100%;
    padding: 12px 15px;
    border: 2px solid #e9ecef;
    border-radius: 8px;
    font-size: 1em;
    transition: all 0.3s ease;
    background: #fafbfc;
    font-family: inherit;
    box-sizing: border-box;
}

.form-control:focus {
    outline: none;
    border-color: #b8860b;
    background: white;
    box-shadow: 0 0 0 3px rgba(184, 134, 11, 0.1);
}

.form-control.error {
    border-color: #dc3545;
    background: #fff5f5;
}

.form-control.success {
    border-color: #28a745;
    background: #f8fff8;
}

.input-group {
    position: relative;
}

.input-icon {
    position: absolute;
    left: 12px;
    top: 50%;
    transform: translateY(-50%);
    color: #6c757d;
    font-size: 1.1em;
    z-index: 1;
}

.form-control.with-icon {
    padding-left: 45px;
}

.form-help {
    margin-top: 5px;
    font-size: 0.85em;
    color: #6c757d;
}

.error-message {
    margin-top: 5px;
    font-size: 0.85em;
    color: #dc3545;
    display: none;
}

.success-message {
    margin-top: 5px;
    font-size: 0.85em;
    color: #28a745;
    display: none;
}

.radio-group {
    display: flex;
    gap: 15px;
    flex-wrap: wrap;
}

.radio-item {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 10px 15px;
    border: 2px solid #e9ecef;
    border-radius: 8px;
    cursor: pointer;
    transition: all 0.2s ease;
    background: #fafbfc;
}

.radio-item:hover {
    border-color: #b8860b;
    background: #fff;
}

.radio-item.selected {
    border-color: #b8860b;
    background: #fff;
    box-shadow: 0 2px 8px rgba(184, 134, 11, 0.15);
}

.radio-item input[type="radio"] {
    margin: 0;
}

.select-enhanced {
    position: relative;
}

.select-enhanced select {
    appearance: none;
    background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6,9 12,15 18,9'%3e%3c/polyline%3e%3c/svg%3e");
    background-repeat: no-repeat;
    background-position: left 12px center;
    background-size: 20px;
    padding-left: 45px;
}

.form-buttons {
    display: flex;
    gap: 15px;
    justify-content: center;
    margin-top: 30px;
    padding: 20px;
    background: #f8f9fa;
    border-radius: 10px;
}

.btn-enhanced {
    padding: 12px 30px;
    border: none;
    border-radius: 8px;
    font-size: 1em;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    display: inline-flex;
    align-items: center;
    gap: 8px;
    text-decoration: none;
    justify-content: center;
    min-width: 120px;
}

.btn-primary-enhanced {
    background: linear-gradient(135deg, #b8860b 0%, #daa520 100%);
    color: #2c2c2c;
    box-shadow: 0 4px 12px rgba(184, 134, 11, 0.3);
}

.btn-primary-enhanced:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(184, 134, 11, 0.4);
    color: #2c2c2c;
}

.btn-secondary-enhanced {
    background: #6c757d;
    color: white;
    box-shadow: 0 4px 12px rgba(108, 117, 125, 0.3);
}

.btn-secondary-enhanced:hover {
    background: #5a6268;
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(108, 117, 125, 0.4);
    color: white;
}

.loading-spinner {
    display: none;
    width: 20px;
    height: 20px;
    border: 2px solid transparent;
    border-top: 2px solid currentColor;
    border-radius: 50%;
    animation: spin 1s linear infinite;
}

@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

.form-validation-summary {
    background: #fff3cd;
    border: 1px solid #ffeaa7;
    border-radius: 8px;
    padding: 15px;
    margin-bottom: 20px;
    display: none;
}

.validation-title {
    font-weight: bold;
    margin-bottom: 10px;
    color: #856404;
}

.validation-list {
    margin: 0;
    padding-right: 20px;
    color: #856404;
}

.birth-date-inputs {
    display: flex;
    gap: 10px;
    align-items: flex-end;
    width: 100%;
}

.date-input-group {
    flex: 1;
    display: flex;
    flex-direction: column;
    gap: 5px;
}

.date-input-group:first-child {
    flex: 0 0 80px; /* Day field - smaller */
}

.date-input-group:nth-child(2) {
    flex: 2; /* Month field - larger */
}

.date-input-group:last-child {
    flex: 0 0 100px; /* Year field - medium */
}

.date-label {
    font-size: 0.9em;
    color: #6c757d;
    font-weight: 600;
    margin-bottom: 5px;
    text-align: center;
}

.date-input {
    text-align: center;
    font-weight: bold;
    height: 45px; /* Same height as other form controls */
    border: 2px solid #e9ecef;
    border-radius: 8px;
    padding: 8px 12px;
    font-size: 1em;
    transition: all 0.3s ease;
    background: #fafbfc;
    font-family: inherit;
    box-sizing: border-box;
}

.date-input:focus {
    outline: none;
    border-color: #b8860b;
    background: white;
    box-shadow: 0 0 0 3px rgba(184, 134, 11, 0.1);
}

.date-input::-webkit-outer-spin-button,
.date-input::-webkit-inner-spin-button {
    -webkit-appearance: none;
    margin: 0;
}

.date-input[type=number] {
    -moz-appearance: textfield;
}

@media (max-width: 768px) {
    .birth-date-inputs {
        flex-direction: column;
        gap: 15px;
    }
    
    .date-input-group:first-child,
    .date-input-group:nth-child(2),
    .date-input-group:last-child {
        flex: 1;
    }
    
    .date-label {
        text-align: right;
    }
}

/* Jalali Date Picker Styles */
.jalali-picker {
    position: absolute;
    top: 100%;
    left: 0;
    right: 0;
    background: white;
    border: 2px solid #b8860b;
    border-radius: 15px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.2);
    z-index: 1000;
    margin-top: 5px;
    font-family: 'Tahoma', sans-serif;
}

.picker-header {
    background: linear-gradient(135deg, #b8860b 0%, #daa520 100%);
    color: white;
    padding: 15px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    border-radius: 13px 13px 0 0;
}

.picker-header button {
    background: rgba(255,255,255,0.2);
    border: none;
    color: white;
    padding: 5px 10px;
    border-radius: 5px;
    cursor: pointer;
    font-weight: bold;
}

.picker-header button:hover {
    background: rgba(255,255,255,0.3);
}

.picker-header .close-btn {
    background: rgba(220,53,69,0.8);
    margin-right: auto;
}

.picker-body {
    padding: 15px;
}

.jalali-calendar-grid {
    display: grid;
    grid-template-columns: repeat(7, 1fr);
    gap: 2px;
    margin-top: 10px;
}

.jalali-weekdays {
    display: grid;
    grid-template-columns: repeat(7, 1fr);
    gap: 2px;
    margin-bottom: 5px;
}

.jalali-weekday {
    text-align: center;
    padding: 8px 4px;
    font-weight: bold;
    color: #666;
    font-size: 0.9em;
}

.jalali-day {
    text-align: center;
    padding: 10px 4px;
    cursor: pointer;
    border-radius: 5px;
    transition: all 0.2s ease;
    font-size: 0.9em;
}

.jalali-day:hover {
    background: #f0f8ff;
    color: #b8860b;
}

.jalali-day.today {
    background: #b8860b;
    color: white;
    font-weight: bold;
}

.jalali-day.selected {
    background: #007bff;
    color: white;
    font-weight: bold;
}

.jalali-day.other-month {
    color: #ccc;
}

.picker-footer {
    padding: 10px 15px;
    border-top: 1px solid #eee;
    display: flex;
    justify-content: space-between;
}

.picker-footer button {
    background: #f8f9fa;
    border: 1px solid #ddd;
    padding: 5px 15px;
    border-radius: 5px;
    cursor: pointer;
    font-size: 0.9em;
}

.picker-footer button:hover {
    background: #e9ecef;
}
</style>

<div class="customer-form-container">
    <div class="page-header-enhanced">
        <h1>ğŸ‘¥ Ø§ÙØ²ÙˆØ¯Ù† Ù…Ø´ØªØ±ÛŒ Ø¬Ø¯ÛŒØ¯</h1>
        <p>Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ù…Ø´ØªØ±ÛŒ Ø¬Ø¯ÛŒØ¯ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯</p>
    </div>

    <!-- Ø®Ù„Ø§ØµÙ‡ Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ -->
    <div class="form-validation-summary" id="validationSummary">
        <div class="validation-title">âš ï¸ Ù„Ø·ÙØ§Ù‹ Ù…ÙˆØ§Ø±Ø¯ Ø²ÛŒØ± Ø±Ø§ Ø¨Ø±Ø±Ø³ÛŒ Ú©Ù†ÛŒØ¯:</div>
        <ul class="validation-list" id="validationList"></ul>
    </div>

    <form id="customerForm" method="POST" action="/customers/add" novalidate>
        <div class="form-sections">
            <!-- Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø´Ø®ØµÛŒ -->
            <div class="form-section">
                <div class="section-header">
                    <h3>
                        <span>ğŸ‘¤</span>
                        Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø´Ø®ØµÛŒ
                    </h3>
                </div>
                <div class="section-body">
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="full_name" class="form-label required">Ù†Ø§Ù… Ùˆ Ù†Ø§Ù… Ø®Ø§Ù†ÙˆØ§Ø¯Ú¯ÛŒ</label>
                            <div class="input-group">
                                <span class="input-icon">ğŸ‘¤</span>
                                <input type="text" id="full_name" name="full_name" 
                                       class="form-control with-icon" required 
                                       placeholder="Ù†Ø§Ù… Ú©Ø§Ù…Ù„ Ù…Ø´ØªØ±ÛŒ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯"
                                       minlength="3" maxlength="200">
                            </div>
                            <div class="error-message" id="full_name_error"></div>
                            <div class="form-help">Ø­Ø¯Ø§Ù‚Ù„ 3 Ùˆ Ø­Ø¯Ø§Ú©Ø«Ø± 200 Ú©Ø§Ø±Ø§Ú©ØªØ±</div>
                        </div>

                        <div class="form-group">
                            <label for="national_id" class="form-label">Ú©Ø¯ Ù…Ù„ÛŒ</label>
                            <div class="input-group">
                                <span class="input-icon">ğŸ†”</span>
                                <input type="text" id="national_id" name="national_id" 
                                       class="form-control with-icon" 
                                       placeholder="Ú©Ø¯ Ù…Ù„ÛŒ 10 Ø±Ù‚Ù…ÛŒ" 
                                       maxlength="10" pattern="[0-9]{10}">
                            </div>
                            <div class="error-message" id="national_id_error"></div>
                            <div class="success-message" id="national_id_success"></div>
                            <div class="form-help">
                                Ú©Ø¯ Ù…Ù„ÛŒ 10 Ø±Ù‚Ù…ÛŒ Ù…Ø¹ØªØ¨Ø± (Ø§Ø®ØªÛŒØ§Ø±ÛŒ)
                                <br><small style="color: #28a745;">Ù†Ù…ÙˆÙ†Ù‡ Ú©Ø¯Ù‡Ø§ÛŒ Ù…Ø¹ØªØ¨Ø±: 0013542419ØŒ 0123456789</small>
                                <br><button type="button" class="btn btn-sm btn-outline-warning mt-1" onclick="skipNationalIdValidation()" style="font-size: 11px;">
                                    ğŸ§ª Ø±Ø¯ Ú©Ø±Ø¯Ù† Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ (Ø­Ø§Ù„Øª ØªØ³Øª)
                                </button>
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="birth_date" class="form-label">ØªØ§Ø±ÛŒØ® ØªÙˆÙ„Ø¯ (Ø´Ù…Ø³ÛŒ)</label>
                            <div class="birth-date-inputs">
                                <div class="date-input-group">
                                    <label class="date-label">Ø±ÙˆØ²</label>
                                    <input type="number" id="birth_day" min="1" max="31" 
                                           class="form-control date-input" placeholder="01">
                                </div>
                                <div class="date-input-group">
                                    <label class="date-label">Ù…Ø§Ù‡</label>
                                    <select id="birth_month" class="form-control date-input">
                                        <option value="">Ø§Ù†ØªØ®Ø§Ø¨ Ù…Ø§Ù‡</option>
                                        <option value="1">1 - ÙØ±ÙˆØ±Ø¯ÛŒÙ†</option>
                                        <option value="2">2 - Ø§Ø±Ø¯ÛŒØ¨Ù‡Ø´Øª</option>
                                        <option value="3">3 - Ø®Ø±Ø¯Ø§Ø¯</option>
                                        <option value="4">4 - ØªÛŒØ±</option>
                                        <option value="5">5 - Ù…Ø±Ø¯Ø§Ø¯</option>
                                        <option value="6">6 - Ø´Ù‡Ø±ÛŒÙˆØ±</option>
                                        <option value="7">7 - Ù…Ù‡Ø±</option>
                                        <option value="8">8 - Ø¢Ø¨Ø§Ù†</option>
                                        <option value="9">9 - Ø¢Ø°Ø±</option>
                                        <option value="10">10 - Ø¯ÛŒ</option>
                                        <option value="11">11 - Ø¨Ù‡Ù…Ù†</option>
                                        <option value="12">12 - Ø§Ø³ÙÙ†Ø¯</option>
                                    </select>
                                </div>
                                <div class="date-input-group">
                                    <label class="date-label">Ø³Ø§Ù„</label>
                                    <input type="number" id="birth_year" min="1300" max="1410" 
                                           class="form-control date-input" placeholder="1380">
                                </div>
                            </div>
                            <input type="hidden" id="birth_date" name="birth_date">
                            <div class="form-help">ØªØ§Ø±ÛŒØ® ØªÙˆÙ„Ø¯ Ø´Ù…Ø³ÛŒ - Ù…Ø«Ø§Ù„: 15 ÙØ±ÙˆØ±Ø¯ÛŒÙ† 1380</div>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Ø¬Ù†Ø³ÛŒØª</label>
                            <div class="radio-group">
                                <label class="radio-item">
                                    <input type="radio" name="gender" value="male">
                                    <span>ğŸ‘¨ Ø¢Ù‚Ø§</span>
                                </label>
                                <label class="radio-item">
                                    <input type="radio" name="gender" value="female">
                                    <span>ğŸ‘© Ø®Ø§Ù†Ù…</span>
                                </label>
                                <label class="radio-item">
                                    <input type="radio" name="gender" value="other">
                                    <span>ğŸ‘¤ Ø³Ø§ÛŒØ±</span>
                                </label>
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="job_title" class="form-label">Ø´ØºÙ„</label>
                            <div class="input-group">
                                <span class="input-icon">ğŸ’¼</span>
                                <input type="text" id="job_title" name="job_title" 
                                       class="form-control with-icon" 
                                       placeholder="Ø´ØºÙ„ Ù…Ø´ØªØ±ÛŒ"
                                       maxlength="100">
                            </div>
                            <div class="form-help">Ø´ØºÙ„ ÛŒØ§ Ø­Ø±ÙÙ‡ Ù…Ø´ØªØ±ÛŒ</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Ø§Ø·Ù„Ø§Ø¹Ø§Øª ØªÙ…Ø§Ø³ -->
            <div class="form-section">
                <div class="section-header">
                    <h3>
                        <span>ğŸ“</span>
                        Ø§Ø·Ù„Ø§Ø¹Ø§Øª ØªÙ…Ø§Ø³
                    </h3>
                </div>
                <div class="section-body">
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="phone" class="form-label">Ø´Ù…Ø§Ø±Ù‡ ØªÙ…Ø§Ø³ Ø§ØµÙ„ÛŒ</label>
                            <div class="input-group">
                                <span class="input-icon">ğŸ“±</span>
                                <input type="tel" id="phone" name="phone" 
                                       class="form-control with-icon" 
                                       placeholder="09xxxxxxxxx"
                                       pattern="09[0-9]{9}" maxlength="11">
                            </div>
                            <div class="error-message" id="phone_error"></div>
                            <div class="form-help">Ø´Ù…Ø§Ø±Ù‡ Ù…ÙˆØ¨Ø§ÛŒÙ„ (09xxxxxxxxx)</div>
                        </div>

                        <div class="form-group">
                            <label for="emergency_phone" class="form-label">ØªÙ…Ø§Ø³ Ø§Ø¶Ø·Ø±Ø§Ø±ÛŒ</label>
                            <div class="input-group">
                                <span class="input-icon">ğŸ†˜</span>
                                <input type="tel" id="emergency_phone" name="emergency_phone" 
                                       class="form-control with-icon" 
                                       placeholder="09xxxxxxxxx"
                                       pattern="09[0-9]{9}" maxlength="11">
                            </div>
                            <div class="error-message" id="emergency_phone_error"></div>
                            <div class="form-help">Ø´Ù…Ø§Ø±Ù‡ ØªÙ…Ø§Ø³ Ø¯Ø± Ù…ÙˆØ§Ù‚Ø¹ Ø¶Ø±ÙˆØ±ÛŒ</div>
                        </div>

                        <div class="form-group">
                            <label for="email" class="form-label">Ø§ÛŒÙ…ÛŒÙ„</label>
                            <div class="input-group">
                                <span class="input-icon">ğŸ“§</span>
                                <input type="email" id="email" name="email" 
                                       class="form-control with-icon" 
                                       placeholder="example@email.com"
                                       maxlength="100">
                            </div>
                            <div class="error-message" id="email_error"></div>
                            <div class="form-help">Ø¢Ø¯Ø±Ø³ Ø§ÛŒÙ…ÛŒÙ„ Ù…Ø¹ØªØ¨Ø±</div>
                        </div>

                        <div class="form-group">
                            <label for="address" class="form-label">Ø¢Ø¯Ø±Ø³ Ú©Ø§Ù…Ù„</label>
                            <textarea id="address" name="address" class="form-control" 
                                      rows="3" placeholder="Ø¢Ø¯Ø±Ø³ Ú©Ø§Ù…Ù„ Ù…Ø´ØªØ±ÛŒ"
                                      maxlength="500"></textarea>
                            <div class="form-help">Ø¢Ø¯Ø±Ø³ Ø¯Ù‚ÛŒÙ‚ Ù…Ø­Ù„ Ø³Ú©ÙˆÙ†Øª ÛŒØ§ Ú©Ø§Ø±</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Ø§Ø·Ù„Ø§Ø¹Ø§Øª ØªÚ©Ù…ÛŒÙ„ÛŒ -->
            <div class="form-section">
                <div class="section-header">
                    <h3>
                        <span>ğŸ“‹</span>
                        Ø§Ø·Ù„Ø§Ø¹Ø§Øª ØªÚ©Ù…ÛŒÙ„ÛŒ
                    </h3>
                </div>
                <div class="section-body">
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="customer_type" class="form-label">Ù†ÙˆØ¹ Ù…Ø´ØªØ±ÛŒ</label>
                            <div class="select-enhanced">
                                <select id="customer_type" name="customer_type" class="form-control">
                                    <option value="normal">ğŸ‘¤ Ø¹Ø§Ø¯ÛŒ</option>
                                    <option value="vip">â­ VIP</option>
                                    <option value="wholesale">ğŸ“¦ Ø¹Ù…Ø¯Ù‡ ÙØ±ÙˆØ´</option>
                                    <option value="regular">ğŸ”„ Ù…Ø´ØªØ±ÛŒ Ø«Ø§Ø¨Øª</option>
                                </select>
                            </div>
                            <div class="form-help">Ø·Ø¨Ù‚Ù‡â€ŒØ¨Ù†Ø¯ÛŒ Ù†ÙˆØ¹ Ù…Ø´ØªØ±ÛŒ</div>
                        </div>

                        <div class="form-group">
                            <label for="reference_name" class="form-label">Ù†Ø§Ù… Ù…Ø¹Ø±Ù</label>
                            <div class="input-group">
                                <span class="input-icon">ğŸ¤</span>
                                <input type="text" id="reference_name" name="reference_name" 
                                       class="form-control with-icon" 
                                       placeholder="Ù†Ø§Ù… Ø´Ø®Øµ Ù…Ø¹Ø±Ù"
                                       maxlength="100">
                            </div>
                            <div class="form-help">Ø´Ø®ØµÛŒ Ú©Ù‡ Ù…Ø´ØªØ±ÛŒ Ø±Ø§ Ù…Ø¹Ø±ÙÛŒ Ú©Ø±Ø¯Ù‡</div>
                        </div>

                        <div class="form-group" style="grid-column: 1 / -1;">
                            <label for="notes" class="form-label">ÛŒØ§Ø¯Ø¯Ø§Ø´Øªâ€ŒÙ‡Ø§</label>
                            <textarea id="notes" name="notes" class="form-control" 
                                      rows="4" placeholder="ÛŒØ§Ø¯Ø¯Ø§Ø´Øªâ€ŒÙ‡Ø§ Ùˆ ØªÙˆØ¶ÛŒØ­Ø§Øª Ø§Ø¶Ø§ÙÛŒ Ø¯Ø± Ù…ÙˆØ±Ø¯ Ù…Ø´ØªØ±ÛŒ"
                                      maxlength="1000"></textarea>
                            <div class="form-help">Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø§Ø¶Ø§ÙÛŒØŒ ØªØ±Ø¬ÛŒØ­Ø§ØªØŒ ÛŒØ§ Ù†Ú©Ø§Øª Ù…Ù‡Ù…</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ÛŒ Ø¹Ù…Ù„ÛŒØ§Øª -->
        <div class="form-buttons">
            <button type="submit" class="btn-enhanced btn-primary-enhanced" id="submitBtn">
                <span class="loading-spinner" id="loadingSpinner"></span>
                <span id="submitText">ğŸ’¾ Ø«Ø¨Øª Ù…Ø´ØªØ±ÛŒ</span>
            </button>
            <a href="/customers" class="btn-enhanced btn-secondary-enhanced">
                âŒ Ø§Ù†ØµØ±Ø§Ù
            </a>
        </div>
    </form>
</div>

<script>
// Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ Ú©Ø¯ Ù…Ù„ÛŒ Ø§ÛŒØ±Ø§Ù†ÛŒ
function validateIranianNationalId(nationalId) {
    if (!nationalId || nationalId.length !== 10) {
        return false;
    }
    
    // Ø¨Ø±Ø±Ø³ÛŒ Ø§ÛŒÙ†Ú©Ù‡ Ù‡Ù…Ù‡ Ø§Ø±Ù‚Ø§Ù… ÛŒÚ©Ø³Ø§Ù† Ù†Ø¨Ø§Ø´Ù†Ø¯
    if (/^(\d)\1{9}$/.test(nationalId)) {
        return false;
    }
    
    var sum = 0;
    for (var i = 0; i < 9; i++) {
        sum += parseInt(nationalId[i]) * (10 - i);
    }
    
    var remainder = sum % 11;
    var checkDigit = parseInt(nationalId[9]);
    
    return (remainder < 2 && checkDigit === remainder) || 
           (remainder >= 2 && checkDigit === 11 - remainder);
}

// Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø±Ù‚Ù… Ú©Ù†ØªØ±Ù„ ØµØ­ÛŒØ­
function calculateCorrectCheckDigit(nationalId) {
    if (!nationalId || nationalId.length < 9) {
        return '?';
    }
    
    var sum = 0;
    for (var i = 0; i < 9; i++) {
        sum += parseInt(nationalId[i]) * (10 - i);
    }
    
    var remainder = sum % 11;
    return remainder < 2 ? remainder : 11 - remainder;
}

// Ø±Ø¯ Ú©Ø±Ø¯Ù† Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ Ú©Ø¯ Ù…Ù„ÛŒ (Ø¨Ø±Ø§ÛŒ ØªØ³Øª)
function skipNationalIdValidation() {
    window.skipNationalIdValidationFlag = true;
    var nationalIdField = document.getElementById('national_id');
    
    if (nationalIdField.value.trim()) {
        showSuccess('national_id', 'ğŸ§ª Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ Ø±Ø¯ Ø´Ø¯ - Ø­Ø§Ù„Øª ØªØ³Øª ÙØ¹Ø§Ù„');
    }
    
    // Ù†Ù…Ø§ÛŒØ´ Ù¾ÛŒØ§Ù… Ù‡Ø´Ø¯Ø§Ø±
    alert('âš ï¸ Ù‡Ø´Ø¯Ø§Ø±: Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ Ú©Ø¯ Ù…Ù„ÛŒ ØºÛŒØ±ÙØ¹Ø§Ù„ Ø´Ø¯!\n\nØ§ÛŒÙ† Ø­Ø§Ù„Øª ÙÙ‚Ø· Ø¨Ø±Ø§ÛŒ ØªØ³Øª Ø¯Ø± Ù†Ø¸Ø± Ú¯Ø±ÙØªÙ‡ Ø´Ø¯Ù‡ Ø§Ø³Øª.\nÙ„Ø·ÙØ§Ù‹ Ø¯Ø± Ù…Ø­ÛŒØ· ØªÙˆÙ„ÛŒØ¯ Ø§Ø² Ú©Ø¯ Ù…Ù„ÛŒ Ù…Ø¹ØªØ¨Ø± Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†ÛŒØ¯.');
}

// Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ Ø´Ù…Ø§Ø±Ù‡ Ù…ÙˆØ¨Ø§ÛŒÙ„
function validatePhoneNumber(phone) {
    return /^09[0-9]{9}$/.test(phone);
}

// Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ Ø§ÛŒÙ…ÛŒÙ„
function validateEmail(email) {
    return /^[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Za-z]{2,}$/.test(email);
}

// Ù†Ù…Ø§ÛŒØ´ Ø®Ø·Ø§
function showError(fieldId, message) {
    var field = document.getElementById(fieldId);
    var errorElement = document.getElementById(fieldId + '_error');
    var successElement = document.getElementById(fieldId + '_success');
    
    field.classList.add('error');
    field.classList.remove('success');
    
    if (errorElement) {
        errorElement.textContent = message;
        errorElement.style.display = 'block';
    }
    
    if (successElement) {
        successElement.style.display = 'none';
    }
}

// Ù†Ù…Ø§ÛŒØ´ Ù…ÙˆÙÙ‚ÛŒØª
function showSuccess(fieldId, message) {
    var field = document.getElementById(fieldId);
    var errorElement = document.getElementById(fieldId + '_error');
    var successElement = document.getElementById(fieldId + '_success');
    
    field.classList.remove('error');
    field.classList.add('success');
    
    if (errorElement) {
        errorElement.style.display = 'none';
    }
    
    if (successElement && message) {
        successElement.textContent = message;
        successElement.style.display = 'block';
    }
}

// Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† Ø®Ø·Ø§
function clearError(fieldId) {
    var field = document.getElementById(fieldId);
    var errorElement = document.getElementById(fieldId + '_error');
    var successElement = document.getElementById(fieldId + '_success');
    
    field.classList.remove('error', 'success');
    
    if (errorElement) {
        errorElement.style.display = 'none';
    }
    
    if (successElement) {
        successElement.style.display = 'none';
    }
}

// Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ ÙØ±Ù…
function validateForm() {
    var isValid = true;
    var errors = [];
    
    // Ù†Ø§Ù… Ú©Ø§Ù…Ù„ (Ø§Ø¬Ø¨Ø§Ø±ÛŒ)
    var fullName = document.getElementById('full_name').value.trim();
    if (!fullName) {
        showError('full_name', 'Ù†Ø§Ù… Ùˆ Ù†Ø§Ù… Ø®Ø§Ù†ÙˆØ§Ø¯Ú¯ÛŒ Ø§Ù„Ø²Ø§Ù…ÛŒ Ø§Ø³Øª');
        errors.push('Ù†Ø§Ù… Ùˆ Ù†Ø§Ù… Ø®Ø§Ù†ÙˆØ§Ø¯Ú¯ÛŒ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯');
        isValid = false;
    } else if (fullName.length < 3) {
        showError('full_name', 'Ù†Ø§Ù… Ø¨Ø§ÛŒØ¯ Ø­Ø¯Ø§Ù‚Ù„ 3 Ú©Ø§Ø±Ø§Ú©ØªØ± Ø¨Ø§Ø´Ø¯');
        errors.push('Ù†Ø§Ù… Ø¨Ø§ÛŒØ¯ Ø­Ø¯Ø§Ù‚Ù„ 3 Ú©Ø§Ø±Ø§Ú©ØªØ± Ø¨Ø§Ø´Ø¯');
        isValid = false;
    } else {
        clearError('full_name');
    }
    
    // Ú©Ø¯ Ù…Ù„ÛŒ (Ø§Ø®ØªÛŒØ§Ø±ÛŒ Ø§Ù…Ø§ Ø§Ú¯Ø± ÙˆØ§Ø±Ø¯ Ø´Ø¯ Ø¨Ø§ÛŒØ¯ Ù…Ø¹ØªØ¨Ø± Ø¨Ø§Ø´Ø¯)
    var nationalId = document.getElementById('national_id').value.trim();
    var skipValidation = window.skipNationalIdValidationFlag || false;
    
    if (nationalId && !skipValidation) {
        if (!validateIranianNationalId(nationalId)) {
            var correctDigit = calculateCorrectCheckDigit(nationalId);
            showError('national_id', `Ú©Ø¯ Ù…Ù„ÛŒ ÙˆØ§Ø±Ø¯ Ø´Ø¯Ù‡ Ù…Ø¹ØªØ¨Ø± Ù†ÛŒØ³Øª. Ú©Ø¯ ØµØ­ÛŒØ­ Ø§Ø­ØªÙ…Ø§Ù„ÛŒ: ${nationalId.substr(0, 9)}${correctDigit}`);
            errors.push('Ú©Ø¯ Ù…Ù„ÛŒ Ù…Ø¹ØªØ¨Ø± Ù†ÛŒØ³Øª ÛŒØ§ Ø§Ø² Ù†Ù…ÙˆÙ†Ù‡â€ŒÙ‡Ø§ÛŒ Ù…Ø¹ØªØ¨Ø± Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†ÛŒØ¯');
            isValid = false;
        } else {
            showSuccess('national_id', 'âœ“ Ú©Ø¯ Ù…Ù„ÛŒ Ù…Ø¹ØªØ¨Ø± Ø§Ø³Øª');
        }
    } else if (nationalId && skipValidation) {
        showSuccess('national_id', 'ğŸ§ª Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ Ø±Ø¯ Ø´Ø¯ (Ø­Ø§Ù„Øª ØªØ³Øª)');
    } else {
        clearError('national_id');
    }
    
    // Ø´Ù…Ø§Ø±Ù‡ ØªÙ…Ø§Ø³
    var phone = document.getElementById('phone').value.trim();
    if (phone && !validatePhoneNumber(phone)) {
        showError('phone', 'Ø´Ù…Ø§Ø±Ù‡ ØªÙ…Ø§Ø³ Ù…Ø¹ØªØ¨Ø± Ù†ÛŒØ³Øª (09xxxxxxxxx)');
        errors.push('Ø´Ù…Ø§Ø±Ù‡ ØªÙ…Ø§Ø³ Ù…Ø¹ØªØ¨Ø± Ù†ÛŒØ³Øª');
        isValid = false;
    } else {
        clearError('phone');
    }
    
    // Ø´Ù…Ø§Ø±Ù‡ Ø§Ø¶Ø·Ø±Ø§Ø±ÛŒ
    var emergencyPhone = document.getElementById('emergency_phone').value.trim();
    if (emergencyPhone && !validatePhoneNumber(emergencyPhone)) {
        showError('emergency_phone', 'Ø´Ù…Ø§Ø±Ù‡ Ø§Ø¶Ø·Ø±Ø§Ø±ÛŒ Ù…Ø¹ØªØ¨Ø± Ù†ÛŒØ³Øª (09xxxxxxxxx)');
        errors.push('Ø´Ù…Ø§Ø±Ù‡ Ø§Ø¶Ø·Ø±Ø§Ø±ÛŒ Ù…Ø¹ØªØ¨Ø± Ù†ÛŒØ³Øª');
        isValid = false;
    } else {
        clearError('emergency_phone');
    }
    
    // Ø§ÛŒÙ…ÛŒÙ„
    var email = document.getElementById('email').value.trim();
    if (email && !validateEmail(email)) {
        showError('email', 'Ø¢Ø¯Ø±Ø³ Ø§ÛŒÙ…ÛŒÙ„ Ù…Ø¹ØªØ¨Ø± Ù†ÛŒØ³Øª');
        errors.push('Ø¢Ø¯Ø±Ø³ Ø§ÛŒÙ…ÛŒÙ„ Ù…Ø¹ØªØ¨Ø± Ù†ÛŒØ³Øª');
        isValid = false;
    } else {
        clearError('email');
    }
    
    // Ù†Ù…Ø§ÛŒØ´ Ø®Ù„Ø§ØµÙ‡ Ø®Ø·Ø§Ù‡Ø§
    var validationSummary = document.getElementById('validationSummary');
    var validationList = document.getElementById('validationList');
    
    if (errors.length > 0) {
        validationList.innerHTML = errors.map(function(error) {
            return '<li>' + error + '</li>';
        }).join('');
        validationSummary.style.display = 'block';
        validationSummary.scrollIntoView({ behavior: 'smooth', block: 'center' });
    } else {
        validationSummary.style.display = 'none';
    }
    
    return isValid;
}

// Event listeners
document.addEventListener('DOMContentLoaded', function() {
    var form = document.getElementById('customerForm');
    var submitBtn = document.getElementById('submitBtn');
    var loadingSpinner = document.getElementById('loadingSpinner');
    var submitText = document.getElementById('submitText');
    
    // Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ real-time Ú©Ø¯ Ù…Ù„ÛŒ
    document.getElementById('national_id').addEventListener('input', function() {
        var value = this.value.trim();
        var skipValidation = window.skipNationalIdValidationFlag || false;
        
        if (value && !skipValidation) {
            if (validateIranianNationalId(value)) {
                showSuccess('national_id', 'âœ“ Ú©Ø¯ Ù…Ù„ÛŒ Ù…Ø¹ØªØ¨Ø± Ø§Ø³Øª');
            } else if (value.length === 10) {
                var correctDigit = calculateCorrectCheckDigit(value);
                showError('national_id', `Ú©Ø¯ Ù…Ù„ÛŒ Ù…Ø¹ØªØ¨Ø± Ù†ÛŒØ³Øª. Ø§Ø­ØªÙ…Ø§Ù„Ø§Ù‹ Ø¨Ø§ÛŒØ¯ ${value.substr(0, 9)}${correctDigit} Ø¨Ø§Ø´Ø¯`);
            } else if (value.length === 9) {
                var correctDigit = calculateCorrectCheckDigit(value + '0');
                this.setAttribute('placeholder', `Ú©Ø¯ Ù…Ù„ÛŒ - Ø±Ù‚Ù… Ø¢Ø®Ø± Ø§Ø­ØªÙ…Ø§Ù„ÛŒ: ${correctDigit}`);
                clearError('national_id');
            } else {
                this.setAttribute('placeholder', 'Ú©Ø¯ Ù…Ù„ÛŒ 10 Ø±Ù‚Ù…ÛŒ');
                clearError('national_id');
            }
        } else if (value && skipValidation) {
            showSuccess('national_id', 'ğŸ§ª Ø­Ø§Ù„Øª ØªØ³Øª - Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ Ø±Ø¯ Ø´Ø¯Ù‡');
        } else {
            this.setAttribute('placeholder', 'Ú©Ø¯ Ù…Ù„ÛŒ 10 Ø±Ù‚Ù…ÛŒ');
            clearError('national_id');
        }
    });
    
    // ÙÙ‚Ø· Ø¹Ø¯Ø¯ Ø¨Ø±Ø§ÛŒ Ú©Ø¯ Ù…Ù„ÛŒ
    document.getElementById('national_id').addEventListener('keypress', function(e) {
        if (!/[0-9]/.test(e.key) && !['Backspace', 'Delete', 'Tab', 'ArrowLeft', 'ArrowRight'].includes(e.key)) {
            e.preventDefault();
        }
    });
    
    // Ø±Ø§Ø¯ÛŒÙˆ Ø¨Ø§ØªÙ†â€ŒÙ‡Ø§ÛŒ Ø¬Ù†Ø³ÛŒØª
    var genderRadios = document.querySelectorAll('input[name="gender"]');
    for (var i = 0; i < genderRadios.length; i++) {
        genderRadios[i].addEventListener('change', function() {
            var radioItems = document.querySelectorAll('.radio-item');
            for (var j = 0; j < radioItems.length; j++) {
                radioItems[j].classList.remove('selected');
            }
            this.closest('.radio-item').classList.add('selected');
        });
    }
    
    // Ø§Ø±Ø³Ø§Ù„ ÙØ±Ù…
    form.addEventListener('submit', function(e) {
        e.preventDefault();
        
        if (!validateForm()) {
            return;
        }
        
        // Ù†Ù…Ø§ÛŒØ´ loading
        submitBtn.disabled = true;
        loadingSpinner.style.display = 'inline-block';
        submitText.textContent = 'Ø¯Ø± Ø­Ø§Ù„ Ø«Ø¨Øª...';
        
        // Ø§Ø±Ø³Ø§Ù„ ÙØ±Ù…
        this.submit();
    });
    
    // Ø§Ù†ÛŒÙ…ÛŒØ´Ù† ÙˆØ±ÙˆØ¯ Ú©Ø§Ø±Øªâ€ŒÙ‡Ø§
    var sections = document.querySelectorAll('.form-section');
    for (var i = 0; i < sections.length; i++) {
        (function(index) {
            var section = sections[index];
            section.style.opacity = '0';
            section.style.transform = 'translateY(20px)';
            section.style.transition = 'opacity 0.6s ease, transform 0.6s ease';
            
            setTimeout(function() {
                section.style.opacity = '1';
                section.style.transform = 'translateY(0)';
            }, 100 * (index + 1));
        })(i);
    }

    // Manual Birth Date Input Handler
    function updateBirthDate() {
        const day = document.getElementById('birth_day').value;
        const month = document.getElementById('birth_month').value;
        const year = document.getElementById('birth_year').value;
        
        if (day && month && year) {
            try {
                // ØªØ¨Ø¯ÛŒÙ„ ØªØ§Ø±ÛŒØ® Ø´Ù…Ø³ÛŒ Ø¨Ù‡ Ù…ÛŒÙ„Ø§Ø¯ÛŒ
                const gregorianDate = moment(`${year}/${month}/${day}`, 'jYYYY/jM/jD');
                
                if (gregorianDate.isValid()) {
                    document.getElementById('birth_date').value = gregorianDate.format('YYYY-MM-DD');
                } else {
                    document.getElementById('birth_date').value = '';
                }
            } catch (error) {
                document.getElementById('birth_date').value = '';
            }
        } else {
            document.getElementById('birth_date').value = '';
        }
    }

    // Add event listeners for birth date inputs
    document.getElementById('birth_day').addEventListener('input', updateBirthDate);
    document.getElementById('birth_month').addEventListener('change', updateBirthDate);
    document.getElementById('birth_year').addEventListener('input', updateBirthDate);
});
</script> 