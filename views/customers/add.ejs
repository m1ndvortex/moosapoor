<!-- ÿßÿ≥ÿ™ÿß€åŸÑ‚ÄåŸáÿß€å ÿßÿÆÿ™ÿµÿßÿµ€å ŸÅÿ±ŸÖ ŸÖÿ¥ÿ™ÿ±€å -->
<style>
.customer-form-container {
    font-family: 'IRANSans', 'Tahoma', sans-serif;
    max-width: 1200px;
    margin: 0 auto;
}

.page-header-enhanced {
    background: linear-gradient(135deg, #b8860b 0%, #daa520 100%);
    color: #2c2c2c;
    padding: 25px;
    border-radius: 10px;
    margin-bottom: 25px;
    text-align: center;
    box-shadow: 0 4px 15px rgba(184, 134, 11, 0.2);
}

.page-header-enhanced h1 {
    margin: 0 0 8px 0;
    font-size: 2em;
    font-weight: bold;
}

.page-header-enhanced p {
    margin: 0;
    opacity: 0.8;
    font-size: 1.1em;
}

.form-sections {
    display: grid;
    gap: 20px;
}

.form-section {
    background: white;
    border: 1px solid #d4c5a0;
    border-radius: 10px;
    overflow: hidden;
    box-shadow: 0 3px 12px rgba(184, 134, 11, 0.1);
    transition: transform 0.2s ease, box-shadow 0.2s ease;
}

.form-section:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(184, 134, 11, 0.15);
}

.section-header {
    background: linear-gradient(135deg, #b8860b 0%, #daa520 100%);
    color: #2c2c2c;
    padding: 15px 20px;
    border-bottom: 1px solid rgba(0,0,0,0.1);
}

.section-header h3 {
    margin: 0;
    font-size: 1.2em;
    font-weight: bold;
    display: flex;
    align-items: center;
    gap: 10px;
}

.section-body {
    padding: 25px;
}

.form-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: 20px;
}

.form-group {
    position: relative;
}

.form-label {
    display: block;
    margin-bottom: 8px;
    font-weight: 600;
    color: #2c2c2c;
    font-size: 0.95em;
}

.form-label.required::after {
    content: ' *';
    color: #dc3545;
    font-weight: bold;
}

.form-control {
    width: 100%;
    padding: 12px 15px;
    border: 2px solid #e9ecef;
    border-radius: 8px;
    font-size: 1em;
    transition: all 0.3s ease;
    background: #fafbfc;
    font-family: inherit;
    box-sizing: border-box;
}

.form-control:focus {
    outline: none;
    border-color: #b8860b;
    background: white;
    box-shadow: 0 0 0 3px rgba(184, 134, 11, 0.1);
}

.form-control.error {
    border-color: #dc3545;
    background: #fff5f5;
}

.form-control.success {
    border-color: #28a745;
    background: #f8fff8;
}

.input-group {
    position: relative;
}

.input-icon {
    position: absolute;
    left: 12px;
    top: 50%;
    transform: translateY(-50%);
    color: #6c757d;
    font-size: 1.1em;
    z-index: 1;
}

.form-control.with-icon {
    padding-left: 45px;
}

.form-help {
    margin-top: 5px;
    font-size: 0.85em;
    color: #6c757d;
}

.error-message {
    margin-top: 5px;
    font-size: 0.85em;
    color: #dc3545;
    display: none;
}

.success-message {
    margin-top: 5px;
    font-size: 0.85em;
    color: #28a745;
    display: none;
}

.radio-group {
    display: flex;
    gap: 15px;
    flex-wrap: wrap;
}

.radio-item {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 10px 15px;
    border: 2px solid #e9ecef;
    border-radius: 8px;
    cursor: pointer;
    transition: all 0.2s ease;
    background: #fafbfc;
}

.radio-item:hover {
    border-color: #b8860b;
    background: #fff;
}

.radio-item.selected {
    border-color: #b8860b;
    background: #fff;
    box-shadow: 0 2px 8px rgba(184, 134, 11, 0.15);
}

.radio-item input[type="radio"] {
    margin: 0;
}

.select-enhanced {
    position: relative;
}

.select-enhanced select {
    appearance: none;
    background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6,9 12,15 18,9'%3e%3c/polyline%3e%3c/svg%3e");
    background-repeat: no-repeat;
    background-position: left 12px center;
    background-size: 20px;
    padding-left: 45px;
}

.form-buttons {
    display: flex;
    gap: 15px;
    justify-content: center;
    margin-top: 30px;
    padding: 20px;
    background: #f8f9fa;
    border-radius: 10px;
}

.btn-enhanced {
    padding: 12px 30px;
    border: none;
    border-radius: 8px;
    font-size: 1em;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    display: inline-flex;
    align-items: center;
    gap: 8px;
    text-decoration: none;
    justify-content: center;
    min-width: 120px;
}

.btn-primary-enhanced {
    background: linear-gradient(135deg, #b8860b 0%, #daa520 100%);
    color: #2c2c2c;
    box-shadow: 0 4px 12px rgba(184, 134, 11, 0.3);
}

.btn-primary-enhanced:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(184, 134, 11, 0.4);
    color: #2c2c2c;
}

.btn-secondary-enhanced {
    background: #6c757d;
    color: white;
    box-shadow: 0 4px 12px rgba(108, 117, 125, 0.3);
}

.btn-secondary-enhanced:hover {
    background: #5a6268;
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(108, 117, 125, 0.4);
    color: white;
}

.loading-spinner {
    display: none;
    width: 20px;
    height: 20px;
    border: 2px solid transparent;
    border-top: 2px solid currentColor;
    border-radius: 50%;
    animation: spin 1s linear infinite;
}

@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

.form-validation-summary {
    background: #fff3cd;
    border: 1px solid #ffeaa7;
    border-radius: 8px;
    padding: 15px;
    margin-bottom: 20px;
    display: none;
}

.validation-title {
    font-weight: bold;
    margin-bottom: 10px;
    color: #856404;
}

.validation-list {
    margin: 0;
    padding-right: 20px;
    color: #856404;
}

.birth-date-inputs {
    display: flex;
    gap: 10px;
    align-items: flex-end;
    width: 100%;
}

.date-input-group {
    flex: 1;
    display: flex;
    flex-direction: column;
    gap: 5px;
}

.date-input-group:first-child {
    flex: 0 0 80px; /* Day field - smaller */
}

.date-input-group:nth-child(2) {
    flex: 2; /* Month field - larger */
}

.date-input-group:last-child {
    flex: 0 0 100px; /* Year field - medium */
}

.date-label {
    font-size: 0.9em;
    color: #6c757d;
    font-weight: 600;
    margin-bottom: 5px;
    text-align: center;
}

.date-input {
    text-align: center;
    font-weight: bold;
    height: 45px; /* Same height as other form controls */
    border: 2px solid #e9ecef;
    border-radius: 8px;
    padding: 8px 12px;
    font-size: 1em;
    transition: all 0.3s ease;
    background: #fafbfc;
    font-family: inherit;
    box-sizing: border-box;
}

.date-input:focus {
    outline: none;
    border-color: #b8860b;
    background: white;
    box-shadow: 0 0 0 3px rgba(184, 134, 11, 0.1);
}

.date-input::-webkit-outer-spin-button,
.date-input::-webkit-inner-spin-button {
    -webkit-appearance: none;
    margin: 0;
}

.date-input[type=number] {
    -moz-appearance: textfield;
}

@media (max-width: 768px) {
    .birth-date-inputs {
        flex-direction: column;
        gap: 15px;
    }
    
    .date-input-group:first-child,
    .date-input-group:nth-child(2),
    .date-input-group:last-child {
        flex: 1;
    }
    
    .date-label {
        text-align: right;
    }
}

/* Jalali Date Picker Styles */
.jalali-picker {
    position: absolute;
    top: 100%;
    left: 0;
    right: 0;
    background: white;
    border: 2px solid #b8860b;
    border-radius: 15px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.2);
    z-index: 1000;
    margin-top: 5px;
    font-family: 'Tahoma', sans-serif;
}

.picker-header {
    background: linear-gradient(135deg, #b8860b 0%, #daa520 100%);
    color: white;
    padding: 15px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    border-radius: 13px 13px 0 0;
}

.picker-header button {
    background: rgba(255,255,255,0.2);
    border: none;
    color: white;
    padding: 5px 10px;
    border-radius: 5px;
    cursor: pointer;
    font-weight: bold;
}

.picker-header button:hover {
    background: rgba(255,255,255,0.3);
}

.picker-header .close-btn {
    background: rgba(220,53,69,0.8);
    margin-right: auto;
}

.picker-body {
    padding: 15px;
}

.jalali-calendar-grid {
    display: grid;
    grid-template-columns: repeat(7, 1fr);
    gap: 2px;
    margin-top: 10px;
}

.jalali-weekdays {
    display: grid;
    grid-template-columns: repeat(7, 1fr);
    gap: 2px;
    margin-bottom: 5px;
}

.jalali-weekday {
    text-align: center;
    padding: 8px 4px;
    font-weight: bold;
    color: #666;
    font-size: 0.9em;
}

.jalali-day {
    text-align: center;
    padding: 10px 4px;
    cursor: pointer;
    border-radius: 5px;
    transition: all 0.2s ease;
    font-size: 0.9em;
}

.jalali-day:hover {
    background: #f0f8ff;
    color: #b8860b;
}

.jalali-day.today {
    background: #b8860b;
    color: white;
    font-weight: bold;
}

.jalali-day.selected {
    background: #007bff;
    color: white;
    font-weight: bold;
}

.jalali-day.other-month {
    color: #ccc;
}

.picker-footer {
    padding: 10px 15px;
    border-top: 1px solid #eee;
    display: flex;
    justify-content: space-between;
}

.picker-footer button {
    background: #f8f9fa;
    border: 1px solid #ddd;
    padding: 5px 15px;
    border-radius: 5px;
    cursor: pointer;
    font-size: 0.9em;
}

.picker-footer button:hover {
    background: #e9ecef;
}
</style>

<div class="customer-form-container">
    <div class="page-header-enhanced">
        <h1>üë• ÿßŸÅÿ≤ŸàÿØŸÜ ŸÖÿ¥ÿ™ÿ±€å ÿ¨ÿØ€åÿØ</h1>
        <p>ÿßÿ∑ŸÑÿßÿπÿßÿ™ ŸÖÿ¥ÿ™ÿ±€å ÿ¨ÿØ€åÿØ ÿ±ÿß Ÿàÿßÿ±ÿØ ⁄©ŸÜ€åÿØ</p>
    </div>

    <!-- ÿÆŸÑÿßÿµŸá ÿßÿπÿ™ÿ®ÿßÿ±ÿ≥ŸÜÿ¨€å -->
    <div class="form-validation-summary" id="validationSummary">
        <div class="validation-title">‚ö†Ô∏è ŸÑÿ∑ŸÅÿßŸã ŸÖŸàÿßÿ±ÿØ ÿ≤€åÿ± ÿ±ÿß ÿ®ÿ±ÿ±ÿ≥€å ⁄©ŸÜ€åÿØ:</div>
        <ul class="validation-list" id="validationList"></ul>
    </div>

    <form id="customerForm" method="POST" action="/customers/add" novalidate>
        <div class="form-sections">
            <!-- ÿßÿ∑ŸÑÿßÿπÿßÿ™ ÿ¥ÿÆÿµ€å -->
            <div class="form-section">
                <div class="section-header">
                    <h3>
                        <span>üë§</span>
                        ÿßÿ∑ŸÑÿßÿπÿßÿ™ ÿ¥ÿÆÿµ€å
                    </h3>
                </div>
                <div class="section-body">
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="full_name" class="form-label required">ŸÜÿßŸÖ Ÿà ŸÜÿßŸÖ ÿÆÿßŸÜŸàÿßÿØ⁄Ø€å</label>
                            <div class="input-group">
                                <span class="input-icon">üë§</span>
                                <input type="text" id="full_name" name="full_name" 
                                       class="form-control with-icon" required 
                                       placeholder="ŸÜÿßŸÖ ⁄©ÿßŸÖŸÑ ŸÖÿ¥ÿ™ÿ±€å ÿ±ÿß Ÿàÿßÿ±ÿØ ⁄©ŸÜ€åÿØ"
                                       minlength="3" maxlength="200">
                            </div>
                            <div class="error-message" id="full_name_error"></div>
                            <div class="form-help">ÿ≠ÿØÿßŸÇŸÑ 3 Ÿà ÿ≠ÿØÿß⁄©ÿ´ÿ± 200 ⁄©ÿßÿ±ÿß⁄©ÿ™ÿ±</div>
                        </div>

                        <div class="form-group">
                            <label for="national_id" class="form-label">⁄©ÿØ ŸÖŸÑ€å</label>
                            <div class="input-group">
                                <span class="input-icon">üÜî</span>
                                <input type="text" id="national_id" name="national_id" 
                                       class="form-control with-icon" 
                                       placeholder="⁄©ÿØ ŸÖŸÑ€å 10 ÿ±ŸÇŸÖ€å" 
                                       maxlength="10" pattern="[0-9]{10}">
                            </div>
                            <div class="error-message" id="national_id_error"></div>
                            <div class="success-message" id="national_id_success"></div>
                            <div class="form-help">
                                ⁄©ÿØ ŸÖŸÑ€å 10 ÿ±ŸÇŸÖ€å ŸÖÿπÿ™ÿ®ÿ± (ÿßÿÆÿ™€åÿßÿ±€å)
                                <br><small style="color: #28a745;">ŸÜŸÖŸàŸÜŸá ⁄©ÿØŸáÿß€å ŸÖÿπÿ™ÿ®ÿ±: 0013542419ÿå 0123456789</small>
                                <br><button type="button" class="btn btn-sm btn-outline-warning mt-1" onclick="skipNationalIdValidation()" style="font-size: 11px;">
                                    üß™ ÿ±ÿØ ⁄©ÿ±ÿØŸÜ ÿßÿπÿ™ÿ®ÿßÿ±ÿ≥ŸÜÿ¨€å (ÿ≠ÿßŸÑÿ™ ÿ™ÿ≥ÿ™)
                                </button>
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="birth_date" class="form-label">ÿ™ÿßÿ±€åÿÆ ÿ™ŸàŸÑÿØ (ÿ¥ŸÖÿ≥€å)</label>
                            <div class="birth-date-inputs">
                                <div class="date-input-group">
                                    <label class="date-label">ÿ±Ÿàÿ≤</label>
                                    <input type="number" id="birth_day" min="1" max="31" 
                                           class="form-control date-input" placeholder="01">
                                </div>
                                <div class="date-input-group">
                                    <label class="date-label">ŸÖÿßŸá</label>
                                    <select id="birth_month" class="form-control date-input">
                                        <option value="">ÿßŸÜÿ™ÿÆÿßÿ® ŸÖÿßŸá</option>
                                        <option value="1">1 - ŸÅÿ±Ÿàÿ±ÿØ€åŸÜ</option>
                                        <option value="2">2 - ÿßÿ±ÿØ€åÿ®Ÿáÿ¥ÿ™</option>
                                        <option value="3">3 - ÿÆÿ±ÿØÿßÿØ</option>
                                        <option value="4">4 - ÿ™€åÿ±</option>
                                        <option value="5">5 - ŸÖÿ±ÿØÿßÿØ</option>
                                        <option value="6">6 - ÿ¥Ÿáÿ±€åŸàÿ±</option>
                                        <option value="7">7 - ŸÖŸáÿ±</option>
                                        <option value="8">8 - ÿ¢ÿ®ÿßŸÜ</option>
                                        <option value="9">9 - ÿ¢ÿ∞ÿ±</option>
                                        <option value="10">10 - ÿØ€å</option>
                                        <option value="11">11 - ÿ®ŸáŸÖŸÜ</option>
                                        <option value="12">12 - ÿßÿ≥ŸÅŸÜÿØ</option>
                                    </select>
                                </div>
                                <div class="date-input-group">
                                    <label class="date-label">ÿ≥ÿßŸÑ</label>
                                    <input type="number" id="birth_year" min="1300" max="1410" 
                                           class="form-control date-input" placeholder="1380">
                                </div>
                            </div>
                            <input type="hidden" id="birth_date" name="birth_date">
                            <div class="form-help">ÿ™ÿßÿ±€åÿÆ ÿ™ŸàŸÑÿØ ÿ¥ŸÖÿ≥€å - ŸÖÿ´ÿßŸÑ: 15 ŸÅÿ±Ÿàÿ±ÿØ€åŸÜ 1380</div>
                        </div>

                        <div class="form-group">
                            <label class="form-label">ÿ¨ŸÜÿ≥€åÿ™</label>
                            <div class="radio-group">
                                <label class="radio-item">
                                    <input type="radio" name="gender" value="male">
                                    <span>üë® ÿ¢ŸÇÿß</span>
                                </label>
                                <label class="radio-item">
                                    <input type="radio" name="gender" value="female">
                                    <span>üë© ÿÆÿßŸÜŸÖ</span>
                                </label>
                                <label class="radio-item">
                                    <input type="radio" name="gender" value="other">
                                    <span>üë§ ÿ≥ÿß€åÿ±</span>
                                </label>
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="job_title" class="form-label">ÿ¥ÿ∫ŸÑ</label>
                            <div class="input-group">
                                <span class="input-icon">üíº</span>
                                <input type="text" id="job_title" name="job_title" 
                                       class="form-control with-icon" 
                                       placeholder="ÿ¥ÿ∫ŸÑ ŸÖÿ¥ÿ™ÿ±€å"
                                       maxlength="100">
                            </div>
                            <div class="form-help">ÿ¥ÿ∫ŸÑ €åÿß ÿ≠ÿ±ŸÅŸá ŸÖÿ¥ÿ™ÿ±€å</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ÿßÿ∑ŸÑÿßÿπÿßÿ™ ÿ™ŸÖÿßÿ≥ -->
            <div class="form-section">
                <div class="section-header">
                    <h3>
                        <span>üìû</span>
                        ÿßÿ∑ŸÑÿßÿπÿßÿ™ ÿ™ŸÖÿßÿ≥
                    </h3>
                </div>
                <div class="section-body">
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="phone" class="form-label">ÿ¥ŸÖÿßÿ±Ÿá ÿ™ŸÖÿßÿ≥ ÿßÿµŸÑ€å</label>
                            <div class="input-group">
                                <span class="input-icon">üì±</span>
                                <input type="tel" id="phone" name="phone" 
                                       class="form-control with-icon" 
                                       placeholder="09xxxxxxxxx"
                                       pattern="09[0-9]{9}" maxlength="11">
                            </div>
                            <div class="error-message" id="phone_error"></div>
                            <div class="form-help">ÿ¥ŸÖÿßÿ±Ÿá ŸÖŸàÿ®ÿß€åŸÑ (09xxxxxxxxx)</div>
                        </div>

                        <div class="form-group">
                            <label for="emergency_phone" class="form-label">ÿ™ŸÖÿßÿ≥ ÿßÿ∂ÿ∑ÿ±ÿßÿ±€å</label>
                            <div class="input-group">
                                <span class="input-icon">üÜò</span>
                                <input type="tel" id="emergency_phone" name="emergency_phone" 
                                       class="form-control with-icon" 
                                       placeholder="09xxxxxxxxx"
                                       pattern="09[0-9]{9}" maxlength="11">
                            </div>
                            <div class="error-message" id="emergency_phone_error"></div>
                            <div class="form-help">ÿ¥ŸÖÿßÿ±Ÿá ÿ™ŸÖÿßÿ≥ ÿØÿ± ŸÖŸàÿßŸÇÿπ ÿ∂ÿ±Ÿàÿ±€å</div>
                        </div>

                        <div class="form-group">
                            <label for="email" class="form-label">ÿß€åŸÖ€åŸÑ</label>
                            <div class="input-group">
                                <span class="input-icon">üìß</span>
                                <input type="email" id="email" name="email" 
                                       class="form-control with-icon" 
                                       placeholder="example@email.com"
                                       maxlength="100">
                            </div>
                            <div class="error-message" id="email_error"></div>
                            <div class="form-help">ÿ¢ÿØÿ±ÿ≥ ÿß€åŸÖ€åŸÑ ŸÖÿπÿ™ÿ®ÿ±</div>
                        </div>

                        <div class="form-group">
                            <label for="address" class="form-label">ÿ¢ÿØÿ±ÿ≥ ⁄©ÿßŸÖŸÑ</label>
                            <textarea id="address" name="address" class="form-control" 
                                      rows="3" placeholder="ÿ¢ÿØÿ±ÿ≥ ⁄©ÿßŸÖŸÑ ŸÖÿ¥ÿ™ÿ±€å"
                                      maxlength="500"></textarea>
                            <div class="form-help">ÿ¢ÿØÿ±ÿ≥ ÿØŸÇ€åŸÇ ŸÖÿ≠ŸÑ ÿ≥⁄©ŸàŸÜÿ™ €åÿß ⁄©ÿßÿ±</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ÿßÿ∑ŸÑÿßÿπÿßÿ™ ÿ™⁄©ŸÖ€åŸÑ€å -->
            <div class="form-section">
                <div class="section-header">
                    <h3>
                        <span>üìã</span>
                        ÿßÿ∑ŸÑÿßÿπÿßÿ™ ÿ™⁄©ŸÖ€åŸÑ€å
                    </h3>
                </div>
                <div class="section-body">
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="customer_type" class="form-label">ŸÜŸàÿπ ŸÖÿ¥ÿ™ÿ±€å</label>
                            <div class="select-enhanced">
                                <select id="customer_type" name="customer_type" class="form-control">
                                    <option value="normal">üë§ ÿπÿßÿØ€å</option>
                                    <option value="vip">‚≠ê VIP</option>
                                    <option value="wholesale">üì¶ ÿπŸÖÿØŸá ŸÅÿ±Ÿàÿ¥</option>
                                    <option value="regular">üîÑ ŸÖÿ¥ÿ™ÿ±€å ÿ´ÿßÿ®ÿ™</option>
                                </select>
                            </div>
                            <div class="form-help">ÿ∑ÿ®ŸÇŸá‚Äåÿ®ŸÜÿØ€å ŸÜŸàÿπ ŸÖÿ¥ÿ™ÿ±€å</div>
                        </div>

                        <div class="form-group">
                            <label for="reference_name" class="form-label">ŸÜÿßŸÖ ŸÖÿπÿ±ŸÅ</label>
                            <div class="input-group">
                                <span class="input-icon">ü§ù</span>
                                <input type="text" id="reference_name" name="reference_name" 
                                       class="form-control with-icon" 
                                       placeholder="ŸÜÿßŸÖ ÿ¥ÿÆÿµ ŸÖÿπÿ±ŸÅ"
                                       maxlength="100">
                            </div>
                            <div class="form-help">ÿ¥ÿÆÿµ€å ⁄©Ÿá ŸÖÿ¥ÿ™ÿ±€å ÿ±ÿß ŸÖÿπÿ±ŸÅ€å ⁄©ÿ±ÿØŸá</div>
                        </div>

                        <div class="form-group" style="grid-column: 1 / -1;">
                            <label for="notes" class="form-label">€åÿßÿØÿØÿßÿ¥ÿ™‚ÄåŸáÿß</label>
                            <textarea id="notes" name="notes" class="form-control" 
                                      rows="4" placeholder="€åÿßÿØÿØÿßÿ¥ÿ™‚ÄåŸáÿß Ÿà ÿ™Ÿàÿ∂€åÿ≠ÿßÿ™ ÿßÿ∂ÿßŸÅ€å ÿØÿ± ŸÖŸàÿ±ÿØ ŸÖÿ¥ÿ™ÿ±€å"
                                      maxlength="1000"></textarea>
                            <div class="form-help">ÿßÿ∑ŸÑÿßÿπÿßÿ™ ÿßÿ∂ÿßŸÅ€åÿå ÿ™ÿ±ÿ¨€åÿ≠ÿßÿ™ÿå €åÿß ŸÜ⁄©ÿßÿ™ ŸÖŸáŸÖ</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ÿØ⁄©ŸÖŸá‚ÄåŸáÿß€å ÿπŸÖŸÑ€åÿßÿ™ -->
        <div class="form-buttons">
            <button type="submit" class="btn-enhanced btn-primary-enhanced" id="submitBtn">
                <span class="loading-spinner" id="loadingSpinner"></span>
                <span id="submitText">üíæ ÿ´ÿ®ÿ™ ŸÖÿ¥ÿ™ÿ±€å</span>
            </button>
            <a href="/customers" class="btn-enhanced btn-secondary-enhanced">
                ‚ùå ÿßŸÜÿµÿ±ÿßŸÅ
            </a>
        </div>
    </form>
</div>

<script>
// ÿßÿπÿ™ÿ®ÿßÿ±ÿ≥ŸÜÿ¨€å ⁄©ÿØ ŸÖŸÑ€å ÿß€åÿ±ÿßŸÜ€å
function validateIranianNationalId(nationalId) {
    if (!nationalId || nationalId.length !== 10) {
        return false;
    }
    
    // ÿ®ÿ±ÿ±ÿ≥€å ÿß€åŸÜ⁄©Ÿá ŸáŸÖŸá ÿßÿ±ŸÇÿßŸÖ €å⁄©ÿ≥ÿßŸÜ ŸÜÿ®ÿßÿ¥ŸÜÿØ
    if (/^(\d)\1{9}$/.test(nationalId)) {
        return false;
    }
    
    var sum = 0;
    for (var i = 0; i < 9; i++) {
        sum += parseInt(nationalId[i]) * (10 - i);
    }
    
    var remainder = sum % 11;
    var checkDigit = parseInt(nationalId[9]);
    
    return (remainder < 2 && checkDigit === remainder) || 
           (remainder >= 2 && checkDigit === 11 - remainder);
}

// ŸÖÿ≠ÿßÿ≥ÿ®Ÿá ÿ±ŸÇŸÖ ⁄©ŸÜÿ™ÿ±ŸÑ ÿµÿ≠€åÿ≠
function calculateCorrectCheckDigit(nationalId) {
    if (!nationalId || nationalId.length < 9) {
        return '?';
    }
    
    var sum = 0;
    for (var i = 0; i < 9; i++) {
        sum += parseInt(nationalId[i]) * (10 - i);
    }
    
    var remainder = sum % 11;
    return remainder < 2 ? remainder : 11 - remainder;
}

// ÿ±ÿØ ⁄©ÿ±ÿØŸÜ ÿßÿπÿ™ÿ®ÿßÿ±ÿ≥ŸÜÿ¨€å ⁄©ÿØ ŸÖŸÑ€å (ÿ®ÿ±ÿß€å ÿ™ÿ≥ÿ™)
function skipNationalIdValidation() {
    window.skipNationalIdValidationFlag = true;
    var nationalIdField = document.getElementById('national_id');
    
    if (nationalIdField.value.trim()) {
        showSuccess('national_id', 'üß™ ÿßÿπÿ™ÿ®ÿßÿ±ÿ≥ŸÜÿ¨€å ÿ±ÿØ ÿ¥ÿØ - ÿ≠ÿßŸÑÿ™ ÿ™ÿ≥ÿ™ ŸÅÿπÿßŸÑ');
    }
    
    // ŸÜŸÖÿß€åÿ¥ Ÿæ€åÿßŸÖ Ÿáÿ¥ÿØÿßÿ±
    alert('‚ö†Ô∏è Ÿáÿ¥ÿØÿßÿ±: ÿßÿπÿ™ÿ®ÿßÿ±ÿ≥ŸÜÿ¨€å ⁄©ÿØ ŸÖŸÑ€å ÿ∫€åÿ±ŸÅÿπÿßŸÑ ÿ¥ÿØ!\n\nÿß€åŸÜ ÿ≠ÿßŸÑÿ™ ŸÅŸÇÿ∑ ÿ®ÿ±ÿß€å ÿ™ÿ≥ÿ™ ÿØÿ± ŸÜÿ∏ÿ± ⁄Øÿ±ŸÅÿ™Ÿá ÿ¥ÿØŸá ÿßÿ≥ÿ™.\nŸÑÿ∑ŸÅÿßŸã ÿØÿ± ŸÖÿ≠€åÿ∑ ÿ™ŸàŸÑ€åÿØ ÿßÿ≤ ⁄©ÿØ ŸÖŸÑ€å ŸÖÿπÿ™ÿ®ÿ± ÿßÿ≥ÿ™ŸÅÿßÿØŸá ⁄©ŸÜ€åÿØ.');
}

// ÿßÿπÿ™ÿ®ÿßÿ±ÿ≥ŸÜÿ¨€å ÿ¥ŸÖÿßÿ±Ÿá ŸÖŸàÿ®ÿß€åŸÑ
function validatePhoneNumber(phone) {
    return /^09[0-9]{9}$/.test(phone);
}

// ÿßÿπÿ™ÿ®ÿßÿ±ÿ≥ŸÜÿ¨€å ÿß€åŸÖ€åŸÑ
function validateEmail(email) {
    return /^[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Za-z]{2,}$/.test(email);
}

// ŸÜŸÖÿß€åÿ¥ ÿÆÿ∑ÿß
function showError(fieldId, message) {
    var field = document.getElementById(fieldId);
    var errorElement = document.getElementById(fieldId + '_error');
    var successElement = document.getElementById(fieldId + '_success');
    
    field.classList.add('error');
    field.classList.remove('success');
    
    if (errorElement) {
        errorElement.textContent = message;
        errorElement.style.display = 'block';
    }
    
    if (successElement) {
        successElement.style.display = 'none';
    }
}

// ŸÜŸÖÿß€åÿ¥ ŸÖŸàŸÅŸÇ€åÿ™
function showSuccess(fieldId, message) {
    var field = document.getElementById(fieldId);
    var errorElement = document.getElementById(fieldId + '_error');
    var successElement = document.getElementById(fieldId + '_success');
    
    field.classList.remove('error');
    field.classList.add('success');
    
    if (errorElement) {
        errorElement.style.display = 'none';
    }
    
    if (successElement && message) {
        successElement.textContent = message;
        successElement.style.display = 'block';
    }
}

// Ÿæÿß⁄© ⁄©ÿ±ÿØŸÜ ÿÆÿ∑ÿß
function clearError(fieldId) {
    var field = document.getElementById(fieldId);
    var errorElement = document.getElementById(fieldId + '_error');
    var successElement = document.getElementById(fieldId + '_success');
    
    field.classList.remove('error', 'success');
    
    if (errorElement) {
        errorElement.style.display = 'none';
    }
    
    if (successElement) {
        successElement.style.display = 'none';
    }
}

// ÿßÿπÿ™ÿ®ÿßÿ±ÿ≥ŸÜÿ¨€å ŸÅÿ±ŸÖ
function validateForm() {
    var isValid = true;
    var errors = [];
    
    // ŸÜÿßŸÖ ⁄©ÿßŸÖŸÑ (ÿßÿ¨ÿ®ÿßÿ±€å)
    var fullName = document.getElementById('full_name').value.trim();
    if (!fullName) {
        showError('full_name', 'ŸÜÿßŸÖ Ÿà ŸÜÿßŸÖ ÿÆÿßŸÜŸàÿßÿØ⁄Ø€å ÿßŸÑÿ≤ÿßŸÖ€å ÿßÿ≥ÿ™');
        errors.push('ŸÜÿßŸÖ Ÿà ŸÜÿßŸÖ ÿÆÿßŸÜŸàÿßÿØ⁄Ø€å ÿ±ÿß Ÿàÿßÿ±ÿØ ⁄©ŸÜ€åÿØ');
        isValid = false;
    } else if (fullName.length < 3) {
        showError('full_name', 'ŸÜÿßŸÖ ÿ®ÿß€åÿØ ÿ≠ÿØÿßŸÇŸÑ 3 ⁄©ÿßÿ±ÿß⁄©ÿ™ÿ± ÿ®ÿßÿ¥ÿØ');
        errors.push('ŸÜÿßŸÖ ÿ®ÿß€åÿØ ÿ≠ÿØÿßŸÇŸÑ 3 ⁄©ÿßÿ±ÿß⁄©ÿ™ÿ± ÿ®ÿßÿ¥ÿØ');
        isValid = false;
    } else {
        clearError('full_name');
    }
    
    // ⁄©ÿØ ŸÖŸÑ€å (ÿßÿÆÿ™€åÿßÿ±€å ÿßŸÖÿß ÿß⁄Øÿ± Ÿàÿßÿ±ÿØ ÿ¥ÿØ ÿ®ÿß€åÿØ ŸÖÿπÿ™ÿ®ÿ± ÿ®ÿßÿ¥ÿØ)
    var nationalId = document.getElementById('national_id').value.trim();
    var skipValidation = window.skipNationalIdValidationFlag || false;
    
    if (nationalId && !skipValidation) {
        if (!validateIranianNationalId(nationalId)) {
            var correctDigit = calculateCorrectCheckDigit(nationalId);
            showError('national_id', `⁄©ÿØ ŸÖŸÑ€å Ÿàÿßÿ±ÿØ ÿ¥ÿØŸá ŸÖÿπÿ™ÿ®ÿ± ŸÜ€åÿ≥ÿ™. ⁄©ÿØ ÿµÿ≠€åÿ≠ ÿßÿ≠ÿ™ŸÖÿßŸÑ€å: ${nationalId.substr(0, 9)}${correctDigit}`);
            errors.push('⁄©ÿØ ŸÖŸÑ€å ŸÖÿπÿ™ÿ®ÿ± ŸÜ€åÿ≥ÿ™ €åÿß ÿßÿ≤ ŸÜŸÖŸàŸÜŸá‚ÄåŸáÿß€å ŸÖÿπÿ™ÿ®ÿ± ÿßÿ≥ÿ™ŸÅÿßÿØŸá ⁄©ŸÜ€åÿØ');
            isValid = false;
        } else {
            showSuccess('national_id', '‚úì ⁄©ÿØ ŸÖŸÑ€å ŸÖÿπÿ™ÿ®ÿ± ÿßÿ≥ÿ™');
        }
    } else if (nationalId && skipValidation) {
        showSuccess('national_id', 'üß™ ÿßÿπÿ™ÿ®ÿßÿ±ÿ≥ŸÜÿ¨€å ÿ±ÿØ ÿ¥ÿØ (ÿ≠ÿßŸÑÿ™ ÿ™ÿ≥ÿ™)');
    } else {
        clearError('national_id');
    }
    
    // ÿ¥ŸÖÿßÿ±Ÿá ÿ™ŸÖÿßÿ≥
    var phone = document.getElementById('phone').value.trim();
    if (phone && !validatePhoneNumber(phone)) {
        showError('phone', 'ÿ¥ŸÖÿßÿ±Ÿá ÿ™ŸÖÿßÿ≥ ŸÖÿπÿ™ÿ®ÿ± ŸÜ€åÿ≥ÿ™ (09xxxxxxxxx)');
        errors.push('ÿ¥ŸÖÿßÿ±Ÿá ÿ™ŸÖÿßÿ≥ ŸÖÿπÿ™ÿ®ÿ± ŸÜ€åÿ≥ÿ™');
        isValid = false;
    } else {
        clearError('phone');
    }
    
    // ÿ¥ŸÖÿßÿ±Ÿá ÿßÿ∂ÿ∑ÿ±ÿßÿ±€å
    var emergencyPhone = document.getElementById('emergency_phone').value.trim();
    if (emergencyPhone && !validatePhoneNumber(emergencyPhone)) {
        showError('emergency_phone', 'ÿ¥ŸÖÿßÿ±Ÿá ÿßÿ∂ÿ∑ÿ±ÿßÿ±€å ŸÖÿπÿ™ÿ®ÿ± ŸÜ€åÿ≥ÿ™ (09xxxxxxxxx)');
        errors.push('ÿ¥ŸÖÿßÿ±Ÿá ÿßÿ∂ÿ∑ÿ±ÿßÿ±€å ŸÖÿπÿ™ÿ®ÿ± ŸÜ€åÿ≥ÿ™');
        isValid = false;
    } else {
        clearError('emergency_phone');
    }
    
    // ÿß€åŸÖ€åŸÑ
    var email = document.getElementById('email').value.trim();
    if (email && !validateEmail(email)) {
        showError('email', 'ÿ¢ÿØÿ±ÿ≥ ÿß€åŸÖ€åŸÑ ŸÖÿπÿ™ÿ®ÿ± ŸÜ€åÿ≥ÿ™');
        errors.push('ÿ¢ÿØÿ±ÿ≥ ÿß€åŸÖ€åŸÑ ŸÖÿπÿ™ÿ®ÿ± ŸÜ€åÿ≥ÿ™');
        isValid = false;
    } else {
        clearError('email');
    }
    
    // ŸÜŸÖÿß€åÿ¥ ÿÆŸÑÿßÿµŸá ÿÆÿ∑ÿßŸáÿß
    var validationSummary = document.getElementById('validationSummary');
    var validationList = document.getElementById('validationList');
    
    if (errors.length > 0) {
        validationList.innerHTML = errors.map(function(error) {
            return '<li>' + error + '</li>';
        }).join('');
        validationSummary.style.display = 'block';
        validationSummary.scrollIntoView({ behavior: 'smooth', block: 'center' });
    } else {
        validationSummary.style.display = 'none';
    }
    
    return isValid;
}

// Event listeners
document.addEventListener('DOMContentLoaded', function() {
    var form = document.getElementById('customerForm');
    var submitBtn = document.getElementById('submitBtn');
    var loadingSpinner = document.getElementById('loadingSpinner');
    var submitText = document.getElementById('submitText');
    
    // ÿßÿπÿ™ÿ®ÿßÿ±ÿ≥ŸÜÿ¨€å real-time ⁄©ÿØ ŸÖŸÑ€å
    document.getElementById('national_id').addEventListener('input', function() {
        var value = this.value.trim();
        var skipValidation = window.skipNationalIdValidationFlag || false;
        
        if (value && !skipValidation) {
            if (validateIranianNationalId(value)) {
                showSuccess('national_id', '‚úì ⁄©ÿØ ŸÖŸÑ€å ŸÖÿπÿ™ÿ®ÿ± ÿßÿ≥ÿ™');
            } else if (value.length === 10) {
                var correctDigit = calculateCorrectCheckDigit(value);
                showError('national_id', `⁄©ÿØ ŸÖŸÑ€å ŸÖÿπÿ™ÿ®ÿ± ŸÜ€åÿ≥ÿ™. ÿßÿ≠ÿ™ŸÖÿßŸÑÿßŸã ÿ®ÿß€åÿØ ${value.substr(0, 9)}${correctDigit} ÿ®ÿßÿ¥ÿØ`);
            } else if (value.length === 9) {
                var correctDigit = calculateCorrectCheckDigit(value + '0');
                this.setAttribute('placeholder', `⁄©ÿØ ŸÖŸÑ€å - ÿ±ŸÇŸÖ ÿ¢ÿÆÿ± ÿßÿ≠ÿ™ŸÖÿßŸÑ€å: ${correctDigit}`);
                clearError('national_id');
            } else {
                this.setAttribute('placeholder', '⁄©ÿØ ŸÖŸÑ€å 10 ÿ±ŸÇŸÖ€å');
                clearError('national_id');
            }
        } else if (value && skipValidation) {
            showSuccess('national_id', 'üß™ ÿ≠ÿßŸÑÿ™ ÿ™ÿ≥ÿ™ - ÿßÿπÿ™ÿ®ÿßÿ±ÿ≥ŸÜÿ¨€å ÿ±ÿØ ÿ¥ÿØŸá');
        } else {
            this.setAttribute('placeholder', '⁄©ÿØ ŸÖŸÑ€å 10 ÿ±ŸÇŸÖ€å');
            clearError('national_id');
        }
    });
    
    // ŸÅŸÇÿ∑ ÿπÿØÿØ ÿ®ÿ±ÿß€å ⁄©ÿØ ŸÖŸÑ€å
    document.getElementById('national_id').addEventListener('keypress', function(e) {
        if (!/[0-9]/.test(e.key) && !['Backspace', 'Delete', 'Tab', 'ArrowLeft', 'ArrowRight'].includes(e.key)) {
            e.preventDefault();
        }
    });
    
    // ÿ±ÿßÿØ€åŸà ÿ®ÿßÿ™ŸÜ‚ÄåŸáÿß€å ÿ¨ŸÜÿ≥€åÿ™
    var genderRadios = document.querySelectorAll('input[name="gender"]');
    for (var i = 0; i < genderRadios.length; i++) {
        genderRadios[i].addEventListener('change', function() {
            var radioItems = document.querySelectorAll('.radio-item');
            for (var j = 0; j < radioItems.length; j++) {
                radioItems[j].classList.remove('selected');
            }
            this.closest('.radio-item').classList.add('selected');
        });
    }
    
    // ÿßÿ±ÿ≥ÿßŸÑ ŸÅÿ±ŸÖ
    form.addEventListener('submit', function(e) {
        e.preventDefault();
        
        if (!validateForm()) {
            return;
        }
        
        // ŸÜŸÖÿß€åÿ¥ loading
        submitBtn.disabled = true;
        loadingSpinner.style.display = 'inline-block';
        submitText.textContent = 'ÿØÿ± ÿ≠ÿßŸÑ ÿ´ÿ®ÿ™...';
        
        // ÿßÿ±ÿ≥ÿßŸÑ ŸÅÿ±ŸÖ
        this.submit();
    });
    
    // ÿßŸÜ€åŸÖ€åÿ¥ŸÜ Ÿàÿ±ŸàÿØ ⁄©ÿßÿ±ÿ™‚ÄåŸáÿß
    var sections = document.querySelectorAll('.form-section');
    for (var i = 0; i < sections.length; i++) {
        (function(index) {
            var section = sections[index];
            section.style.opacity = '0';
            section.style.transform = 'translateY(20px)';
            section.style.transition = 'opacity 0.6s ease, transform 0.6s ease';
            
            setTimeout(function() {
                section.style.opacity = '1';
                section.style.transform = 'translateY(0)';
            }, 100 * (index + 1));
        })(i);
    }

    // Manual Birth Date Input Handler
    function updateBirthDate() {
        const day = document.getElementById('birth_day').value;
        const month = document.getElementById('birth_month').value;
        const year = document.getElementById('birth_year').value;
        
        if (day && month && year) {
            try {
                // ÿ™ÿ®ÿØ€åŸÑ ÿ™ÿßÿ±€åÿÆ ÿ¥ŸÖÿ≥€å ÿ®Ÿá ŸÖ€åŸÑÿßÿØ€å
                const gregorianDate = moment(`${year}/${month}/${day}`, 'jYYYY/jM/jD');
                
                if (gregorianDate.isValid()) {
                    document.getElementById('birth_date').value = gregorianDate.format('YYYY-MM-DD');
                } else {
                    document.getElementById('birth_date').value = '';
                }
            } catch (error) {
                document.getElementById('birth_date').value = '';
            }
        } else {
            document.getElementById('birth_date').value = '';
        }
    }

    // Add event listeners for birth date inputs
    document.getElementById('birth_day').addEventListener('input', updateBirthDate);
    document.getElementById('birth_month').addEventListener('change', updateBirthDate);
    document.getElementById('birth_year').addEventListener('input', updateBirthDate);
});
</script> 