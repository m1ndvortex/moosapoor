<div class="page-header">
    <h1 class="page-title">ุชุงุฑุฎฺู ุจฺฉโุขูพ</h1>
    <p>ูุฏุฑุช ูุงูโูุง ุจฺฉโุขูพ ุณุณุชู</p>
</div>

<!-- Statistics -->
<div class="stats-grid" style="grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));">
    <div class="stat-card">
        <div class="stat-number"><%= backups.length %></div>
        <div class="stat-label">ฺฉู ุจฺฉโุขูพโูุง</div>
        <div class="stat-icon" style="color: #007bff;">๐พ</div>
    </div>
    
    <div class="stat-card">
        <div class="stat-number">
            <%= backups.filter(b => b.status === 'success').length %>
        </div>
        <div class="stat-label">ูููู</div>
        <div class="stat-icon" style="color: #28a745;">โ</div>
    </div>
    
    <div class="stat-card">
        <div class="stat-number">
            <%= backups.filter(b => b.status === 'failed').length %>
        </div>
        <div class="stat-label">ูุงูููู</div>
        <div class="stat-icon" style="color: #dc3545;">โ</div>
    </div>
    
    <div class="stat-card">
        <div class="stat-number">
            <%= Math.round(backups.reduce((sum, b) => sum + (b.file_size || 0), 0) / (1024 * 1024)) %> MB
        </div>
        <div class="stat-label">ุญุฌู ฺฉู</div>
        <div class="stat-icon" style="color: #6f42c1;">๐ฆ</div>
    </div>
</div>

<!-- Backup Files Table -->
<div class="card">
    <div class="card-header">
        ูุงูโูุง ุจฺฉโุขูพ
        <a href="/settings" class="btn btn-secondary btn-sm float-left">ุจุงุฒฺฏุดุช ุจู ุชูุธูุงุช</a>
    </div>
    <div class="card-body">
        <% if (backups.length === 0) { %>
            <div style="text-align: center; padding: 50px; color: #666;">
                <i class="fas fa-archive fa-3x"></i><br><br>
                <h5>ูููุฒ ุจฺฉโุขูพ ุงุฌุงุฏ ูุดุฏู</h5>
                <p>ุจุฑุง ุดุฑูุนุ ุงููู ุจฺฉโุขูพ ุฎูุฏ ุฑุง ุงุฌุงุฏ ฺฉูุฏ</p>
                <a href="/settings" class="btn btn-primary">ุฑูุชู ุจู ุชูุธูุงุช</a>
            </div>
        <% } else { %>
            <div class="table-responsive">
                <table class="table table-striped table-hover">
                    <thead style="background: #f8f9fa;">
                        <tr>
                            <th>ูุงู ูุงู</th>
                            <th>ููุน</th>
                            <th>ุชูุถุญุงุช</th>
                            <th>ุชุงุฑุฎ ุงุฌุงุฏ</th>
                            <th>ูุถุนุช</th>
                            <th>ุญุฌู</th>
                            <th>ุงุฌุงุฏฺฉููุฏู</th>
                            <th>ุนููุงุช</th>
                        </tr>
                    </thead>
                    <tbody>
                        <% backups.forEach(backup => { %>
                            <tr>
                                <td>
                                    <code style="font-size: 12px;"><%= backup.filename %></code>
                                </td>
                                <td>
                                    <% if (backup.backup_type === 'full') { %>
                                        <span class="badge badge-primary">ฺฉุงูู</span>
                                    <% } else if (backup.backup_type === 'data') { %>
                                        <span class="badge badge-success">ุงุทูุงุนุงุช</span>
                                    <% } else if (backup.backup_type === 'schema') { %>
                                        <span class="badge badge-info">ุณุงุฎุชุงุฑ</span>
                                    <% } %>
                                </td>
                                <td>
                                    <%= backup.description || '-' %>
                                </td>
                                <td>
                                    <%= new Date(backup.created_at).toLocaleDateString('fa-IR') %><br>
                                    <small class="text-muted">
                                        <%= new Date(backup.created_at).toLocaleTimeString('fa-IR', {hour: '2-digit', minute: '2-digit'}) %>
                                    </small>
                                </td>
                                <td>
                                    <% if (backup.status === 'success') { %>
                                        <span class="badge badge-success">ูููู</span>
                                    <% } else if (backup.status === 'failed') { %>
                                        <span class="badge badge-danger" title="<%= backup.error_message || '' %>">ูุงูููู</span>
                                    <% } else { %>
                                        <span class="badge badge-warning">ุฏุฑ ุญุงู ูพุฑุฏุงุฒุด</span>
                                    <% } %>
                                </td>
                                <td>
                                    <% if (backup.file_size) { %>
                                        <%= Math.round(backup.file_size / 1024) %> KB
                                    <% } else { %>
                                        -
                                    <% } %>
                                </td>
                                <td>
                                    <%= backup.created_by_name || 'ูุงูุดุฎุต' %>
                                </td>
                                <td>
                                    <div class="btn-group btn-group-sm">
                                        <% if (backup.status === 'success') { %>
                                            <a href="/backup/download/<%= backup.id %>" 
                                               class="btn btn-outline-primary btn-sm" 
                                               title="ุฏุงูููุฏ">
                                                ุฏุงูููุฏ
                                            </a>
                                        <% } %>
                                        <button onclick="deleteBackup(<%= backup.id %>)" 
                                                class="btn btn-outline-danger btn-sm" 
                                                title="ุญุฐู">
                                            ุญุฐู
                                        </button>
                                    </div>
                                </td>
                            </tr>
                        <% }); %>
                    </tbody>
                </table>
            </div>
        <% } %>
    </div>
</div>

<script>
function deleteBackup(backupId) {
    if (confirm('ุขุง ุงุฒ ุญุฐู ุงู ูุงู ุจฺฉโุขูพ ูุทูุฆู ูุณุชุฏุ')) {
        fetch(`/backup/delete/${backupId}`, {
            method: 'DELETE'
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                location.reload();
            } else {
                alert('ุฎุทุง ุฏุฑ ุญุฐู ูุงู: ' + data.message);
            }
        })
        .catch(error => {
            alert('ุฎุทุง ุฏุฑ ุญุฐู ูุงู');
        });
    }
}

// Auto refresh for processing backups
if (document.querySelector('.badge-warning')) {
    setTimeout(() => {
        location.reload();
    }, 5000); // Refresh every 5 seconds if there are processing backups
}
</script> 