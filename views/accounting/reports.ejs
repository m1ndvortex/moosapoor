<div class="page-header">
    <h1 class="page-title">ฺฏุฒุงุฑุดุงุช ูุงู</h1>
    <p>ุขูุงุฑ ู ุชุญููโูุง ูุงู ุทูุงูุฑูุด</p>
</div>

<!-- Period Filter -->
<div class="card">
    <div class="card-header">
        ุงูุชุฎุงุจ ุฏูุฑู ุฒูุงู
    </div>
    <div class="card-body">
        <form method="GET" action="/accounting/reports">
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; align-items: end;">
                <div class="form-group">
                    <label>ุฏูุฑู:</label>
                    <select name="period" class="form-control">
                        <option value="today" <%= period === 'today' ? 'selected' : '' %>>ุงูุฑูุฒ</option>
                        <option value="week" <%= period === 'week' ? 'selected' : '' %>>ููุชู ฺฏุฐุดุชู</option>
                        <option value="month" <%= period === 'month' ? 'selected' : '' %>>ูุงู ุฌุงุฑ</option>
                        <option value="custom" <%= period === 'custom' ? 'selected' : '' %>>ุณูุงุฑุด</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <button type="submit" class="btn btn-primary">ุจุฑูุฒุฑุณุงู ฺฏุฒุงุฑุด</button>
                </div>
            </div>
            
            <div style="margin-top: 15px; padding: 10px; background: #f8f9fa; border-radius: 5px;">
                <small class="text-muted">
                    ุฏูุฑู ุงูุชุฎุงุจ ุดุฏู: ุงุฒ <%= moment(dateRange.startDate).format('jYYYY/jM/jD') %> 
                    ุชุง <%= moment(dateRange.endDate).format('jYYYY/jM/jD') %>
                </small>
            </div>
        </form>
    </div>
</div>

<!-- Sales Summary -->
<div class="card">
    <div class="card-header">
        ุฎูุงุตู ูุฑูุด
    </div>
    <div class="card-body">
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px;">
            <div style="text-align: center; padding: 20px; background: #e8f5e8; border-radius: 8px; border: 2px solid #28a745;">
                <h3 style="color: #28a745; margin: 0;">
                    <%= formatNumber(salesReport.invoice_count) %> ูุงฺฉุชูุฑ
                </h3>
                <p style="margin: 5px 0 0 0; color: #666;">
                    ุชุนุฏุงุฏ ูุงฺฉุชูุฑูุง ูุฑูุด
                </p>
            </div>
            
            <div style="text-align: center; padding: 20px; background: #e3f2fd; border-radius: 8px; border: 2px solid #2196f3;">
                <h3 style="color: #2196f3; margin: 0;">
                    <%= formatNumber(salesReport.total_sales) %> ุฑุงู
                </h3>
                <p style="margin: 5px 0 0 0; color: #666;">
                    ูุฌููุน ูุฑูุด
                </p>
            </div>
            
            <div style="text-align: center; padding: 20px; background: #fff3e0; border-radius: 8px; border: 2px solid #ff9800;">
                <h3 style="color: #ff9800; margin: 0;">
                    <%= formatNumber(Math.round(salesReport.avg_sale)) %> ุฑุงู
                </h3>
                <p style="margin: 5px 0 0 0; color: #666;">
                    ูุงูฺฏู ูุฑูุด
                </p>
            </div>
        </div>
    </div>
</div>

<!-- Payment Analysis -->
<div class="card">
    <div class="card-header">
        ุชุญูู ูพุฑุฏุงุฎุชโูุง
    </div>
    <div class="card-body">
        <% if (paymentReport.length === 0) { %>
            <div style="text-align: center; padding: 40px; color: #666;">
                ูฺ ูพุฑุฏุงุฎุช ุฏุฑ ุงู ุฏูุฑู ุงูุช ูุดุฏ
            </div>
        <% } else { %>
            <div class="table-responsive">
                <table class="table table-striped">
                    <thead style="background: #f8f9fa;">
                        <tr>
                            <th>ุฑูุด ูพุฑุฏุงุฎุช</th>
                            <th>ุชุนุฏุงุฏ</th>
                            <th>ูุฌููุน ูุจูุบ (ุฑุงู)</th>
                            <th>ุฏุฑุตุฏ</th>
                        </tr>
                    </thead>
                    <tbody>
                        <% 
                            const totalPayments = paymentReport.reduce((sum, p) => sum + parseFloat(p.total_payments || 0), 0);
                        %>
                        <% paymentReport.forEach(payment => { %>
                            <% const percentage = totalPayments > 0 ? ((payment.total_payments / totalPayments) * 100).toFixed(1) : 0; %>
                            <tr>
                                <td>
                                    <% if (payment.payment_method === 'cash') { %>
                                        <span class="badge badge-success">ููุฏ</span>
                                    <% } else if (payment.payment_method === 'card') { %>
                                        <span class="badge badge-info">ฺฉุงุฑุช</span>
                                    <% } else if (payment.payment_method === 'transfer') { %>
                                        <span class="badge badge-warning">ุญูุงูู</span>
                                    <% } else { %>
                                        <span class="badge badge-secondary"><%= payment.payment_method %></span>
                                    <% } %>
                                </td>
                                <td><%= formatNumber(payment.payment_count) %></td>
                                <td style="text-align: left;"><%= formatNumber(payment.total_payments) %></td>
                                <td>
                                    <div style="display: flex; align-items: center; gap: 10px;">
                                        <span><%= percentage %>%</span>
                                        <div style="flex: 1; height: 8px; background: #e9ecef; border-radius: 4px;">
                                            <div style="height: 100%; background: #28a745; border-radius: 4px; width: <%= percentage %>%;"></div>
                                        </div>
                                    </div>
                                </td>
                            </tr>
                        <% }); %>
                    </tbody>
                </table>
            </div>
        <% } %>
    </div>
</div>

<!-- Top Customers -->
<div class="card">
    <div class="card-header">
        ูุดุชุฑุงู ุจุฑุชุฑ (ุฏุฑ ุฏูุฑู ุงูุชุฎุงุจ ุดุฏู)
    </div>
    <div class="card-body">
        <% if (topCustomers.length === 0) { %>
            <div style="text-align: center; padding: 40px; color: #666;">
                ูฺ ุฎุฑุฏ ุฏุฑ ุงู ุฏูุฑู ุงูุช ูุดุฏ
            </div>
        <% } else { %>
            <div class="table-responsive">
                <table class="table table-hover">
                    <thead style="background: #f8f9fa;">
                        <tr>
                            <th>ุฑุชุจู</th>
                            <th>ฺฉุฏ ูุดุชุฑ</th>
                            <th>ูุงู ูุดุชุฑ</th>
                            <th>ูุฌููุน ุฎุฑุฏ (ุฑุงู)</th>
                            <th>ุฏุฑุตุฏ ุงุฒ ฺฉู ูุฑูุด</th>
                        </tr>
                    </thead>
                    <tbody>
                        <% 
                            const totalCustomerPurchases = topCustomers.reduce((sum, c) => sum + parseFloat(c.total_purchases || 0), 0);
                        %>
                        <% topCustomers.forEach((customer, index) => { %>
                            <% const percentage = totalCustomerPurchases > 0 ? ((customer.total_purchases / totalCustomerPurchases) * 100).toFixed(1) : 0; %>
                            <tr>
                                <td>
                                    <% if (index === 0) { %>
                                        <span style="color: #ffd700; font-size: 18px;">๐ฅ</span>
                                    <% } else if (index === 1) { %>
                                        <span style="color: #c0c0c0; font-size: 18px;">๐ฅ</span>
                                    <% } else if (index === 2) { %>
                                        <span style="color: #cd7f32; font-size: 18px;">๐ฅ</span>
                                    <% } else { %>
                                        <span style="color: #666;"><%= index + 1 %></span>
                                    <% } %>
                                </td>
                                <td>
                                    <code><%= customer.customer_code %></code>
                                </td>
                                <td>
                                    <strong><%= customer.full_name %></strong>
                                </td>
                                <td style="text-align: left; font-weight: bold;">
                                    <%= formatNumber(customer.total_purchases) %>
                                </td>
                                <td>
                                    <div style="display: flex; align-items: center; gap: 10px;">
                                        <span><%= percentage %>%</span>
                                        <div style="flex: 1; height: 8px; background: #e9ecef; border-radius: 4px;">
                                            <div style="height: 100%; background: #007bff; border-radius: 4px; width: <%= percentage %>%;"></div>
                                        </div>
                                    </div>
                                </td>
                            </tr>
                        <% }); %>
                    </tbody>
                </table>
            </div>
        <% } %>
    </div>
</div>

<!-- Quick Actions -->
<div class="card">
    <div class="card-header">
        ุนููุงุช
    </div>
    <div class="card-body">
        <div style="display: flex; gap: 10px; flex-wrap: wrap;">
            <a href="/accounting" class="btn btn-secondary">ุจุงุฒฺฏุดุช ุจู ุญุณุงุจุฏุงุฑ</a>
            <a href="/accounting/general-ledger" class="btn btn-info">ุฏูุชุฑ ฺฉู</a>
            <a href="/accounting/customer-accounts" class="btn btn-success">ุญุณุงุจ ูุดุชุฑุงู</a>
            <button onclick="window.print()" class="btn btn-outline-primary">ฺุงูพ ฺฏุฒุงุฑุด</button>
        </div>
    </div>
</div> 