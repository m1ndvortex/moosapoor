<%
// Safety check for reportData
if (typeof reportData === 'undefined') {
    reportData = {
        salesRevenue: 0, purchaseRevenue: 0, totalRevenue: 0, totalExpenses: 0,
        grossProfit: 0, netIncome: 0, salesPercentage: 0, purchasePercentage: 0,
        netIncomePercentage: 0, cashBalance: 0, customerBalances: 0, inventoryValue: 0,
        totalAssets: 0, supplierBalances: 0, totalLiabilities: 0, totalEquity: 0,
        cashInflows: 0, cashOutflows: 0, netCashFlow: 0, currentRatio: 0,
        profitMargin: 0, assetTurnover: 0, debtRatio: 0
    };
}
%>

<div class="page-header">
    <h1 class="page-title">ฺฏุฒุงุฑุดุงุช ูุงู ูพุดุฑูุชู</h1>
    <p>ุตูุฑุชโูุง ูุงูุ ุณูุฏ ู ุฒุงูุ ุชุฑุงุฒูุงูู ู ุชุญููโูุง ูุงู</p>
</div>

<!-- Report Selection -->
<div class="card">
    <div class="card-header">
        ุงูุชุฎุงุจ ฺฏุฒุงุฑุด
    </div>
    <div class="card-body">
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px;">
            <button class="btn btn-primary btn-lg" onclick="showReport('profit-loss')" id="btn-profit-loss">
                <strong>๐ ุตูุฑุช ุณูุฏ ู ุฒุงู</strong><br>
                <small>ุฏุฑุขูุฏูุง ู ูุฒููโูุง</small>
            </button>
            
            <button class="btn btn-outline-success btn-lg" onclick="showReport('balance-sheet')" id="btn-balance-sheet">
                <strong>๐ฆ ุชุฑุงุฒูุงูู</strong><br>
                <small>ุฏุงุฑุงโูุงุ ุจุฏูโูุง ู ุญููู ูุงูฺฉุงูู</small>
            </button>
            
            <button class="btn btn-outline-info btn-lg" onclick="showReport('cash-flow')" id="btn-cash-flow">
                <strong>๐ฐ ุตูุฑุช ุฌุฑุงู ูุฌู ููุฏ</strong><br>
                <small>ุฌุฑุงูโูุง ููุฏ</small>
            </button>
            
            <button class="btn btn-outline-warning btn-lg" onclick="showReport('financial-analysis')" id="btn-financial-analysis">
                <strong>๐ ุชุญูู ูุงู</strong><br>
                <small>ูุณุจุชโูุง ู ุงุนุฏุงุฏ ฺฉูุฏ</small>
            </button>
        </div>
    </div>
</div>

<!-- Profit & Loss Statement -->
<div id="profit-loss-report" class="report-section">
    <div class="card">
        <div class="card-header">
            ๐ ุตูุฑุช ุณูุฏ ู ุฒุงู
            <span class="float-left">ุงุฒ <%= startDate %> ุชุง <%= endDate %></span>
        </div>
        <div class="card-body">
            <div class="table-responsive">
                <table class="table table-bordered">
                    <thead style="background: #f8f9fa;">
                        <tr>
                            <th>ุดุฑุญ</th>
                            <th style="text-align: left; width: 200px;">ูุจูุบ (ุฑุงู)</th>
                            <th style="text-align: center; width: 100px;">ุฏุฑุตุฏ</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Revenue Section -->
                        <tr style="background: #e8f5e8;">
                            <td colspan="3"><strong>ุฏุฑุขูุฏูุง</strong></td>
                        </tr>
                        <tr>
                            <td>&nbsp;&nbsp;&nbsp;&nbsp;ูุฑูุด ุทูุง</td>
                            <td style="text-align: left;"><%= reportData.salesRevenue.toLocaleString('fa-IR') %></td>
                            <td style="text-align: center;"><%= reportData.salesPercentage %>%</td>
                        </tr>
                        <tr>
                            <td>&nbsp;&nbsp;&nbsp;&nbsp;ุฎุฑุฏ ุทูุง</td>
                            <td style="text-align: left;"><%= reportData.purchaseRevenue.toLocaleString('fa-IR') %></td>
                            <td style="text-align: center;"><%= reportData.purchasePercentage %>%</td>
                        </tr>
                        <tr style="font-weight: bold; background: #d4edda;">
                            <td><strong>ูุฌููุน ุฏุฑุขูุฏูุง</strong></td>
                            <td style="text-align: left;"><strong><%= reportData.totalRevenue.toLocaleString('fa-IR') %></strong></td>
                            <td style="text-align: center;"><strong>100%</strong></td>
                        </tr>
                        
                        <!-- Expenses -->
                        <tr style="background: #f8d7da;">
                            <td colspan="3"><strong>ูุฒููโูุง</strong></td>
                        </tr>
                        <tr>
                            <td>&nbsp;&nbsp;&nbsp;&nbsp;ฺฉู ูุฒููโูุง</td>
                            <td style="text-align: left;"><%= reportData.totalExpenses.toLocaleString('fa-IR') %></td>
                            <td style="text-align: center;">-</td>
                        </tr>
                        
                        <!-- Net Income -->
                        <tr style="font-weight: bold; background: #28a745; color: white; font-size: 1.1em;">
                            <td><strong>ุณูุฏ ุฎุงูุต</strong></td>
                            <td style="text-align: left;"><strong><%= reportData.netIncome.toLocaleString('fa-IR') %></strong></td>
                            <td style="text-align: center;"><strong><%= reportData.netIncomePercentage %>%</strong></td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<!-- Balance Sheet -->
<div id="balance-sheet-report" class="report-section" style="display: none;">
    <div class="card">
        <div class="card-header">
            ๐ฆ ุชุฑุงุฒูุงูู
            <span class="float-left">ุฏุฑ ุชุงุฑุฎ 1403/09/30</span>
        </div>
        <div class="card-body">
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                <!-- Assets -->
                <div>
                    <table class="table table-bordered">
                        <thead style="background: #d4edda;">
                            <tr>
                                <th colspan="2" class="text-center"><strong>ุฏุงุฑุงโูุง</strong></th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr style="background: #e8f5e8;">
                                <td colspan="2"><strong>ุฏุงุฑุงโูุง ุฌุงุฑ</strong></td>
                            </tr>
                            <tr>
                                <td>&nbsp;&nbsp;ุตูุฏูู ู ุจุงูฺฉ</td>
                                <td style="text-align: left;"><%= reportData.cashBalance.toLocaleString('fa-IR') %></td>
                            </tr>
                            <tr>
                                <td>&nbsp;&nbsp;ุทูุจ ูุดุชุฑุงู</td>
                                <td style="text-align: left;"><%= reportData.customerBalances.toLocaleString('fa-IR') %></td>
                            </tr>
                            <tr>
                                <td>&nbsp;&nbsp;ููุฌูุฏ ฺฉุงูุง</td>
                                <td style="text-align: left;"><%= reportData.inventoryValue.toLocaleString('fa-IR') %></td>
                            </tr>
                            <tr style="font-weight: bold; background: #d4edda;">
                                <td><strong>ุฌูุน ุฏุงุฑุงโูุง ุฌุงุฑ</strong></td>
                                <td style="text-align: left;"><strong><%= reportData.totalAssets.toLocaleString('fa-IR') %></strong></td>
                            </tr>
                            
                            <tr style="height: 10px;">
                                <td colspan="2"></td>
                            </tr>
                            
                            <tr style="background: #e8f5e8;">
                                <td colspan="2"><strong>ุฏุงุฑุงโูุง ุซุงุจุช</strong></td>
                            </tr>
                            <tr>
                                <td>&nbsp;&nbsp;ุชุฌูุฒุงุช</td>
                                <td style="text-align: left;">45,000,000</td>
                            </tr>
                            <tr>
                                <td>&nbsp;&nbsp;ุงุณุชููุงฺฉ ุงูุจุงุดุชู</td>
                                <td style="text-align: left;">(15,000,000)</td>
                            </tr>
                            <tr style="font-weight: bold; background: #d4edda;">
                                <td><strong>ุฌูุน ุฏุงุฑุงโูุง ุซุงุจุช</strong></td>
                                <td style="text-align: left;"><strong>30,000,000</strong></td>
                            </tr>
                            
                            <tr style="font-weight: bold; background: #28a745; color: white;">
                                <td><strong>ูุฌููุน ุฏุงุฑุงโูุง</strong></td>
                                <td style="text-align: left;"><strong><%= reportData.totalAssets.toLocaleString('fa-IR') %></strong></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                
                <!-- Liabilities & Equity -->
                <div>
                    <table class="table table-bordered">
                        <thead style="background: #f8d7da;">
                            <tr>
                                <th colspan="2" class="text-center"><strong>ุจุฏูโูุง ู ุญููู ูุงูฺฉุงูู</strong></th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr style="background: #f8d7da;">
                                <td colspan="2"><strong>ุจุฏูโูุง ุฌุงุฑ</strong></td>
                            </tr>
                            <tr>
                                <td>&nbsp;&nbsp;ุญุณุงุจโูุง ูพุฑุฏุงุฎุชู</td>
                                <td style="text-align: left;"><%= reportData.supplierBalances.toLocaleString('fa-IR') %></td>
                            </tr>
                            <tr style="font-weight: bold; background: #f5c6cb;">
                                <td><strong>ุฌูุน ุจุฏูโูุง ุฌุงุฑ</strong></td>
                                <td style="text-align: left;"><strong><%= reportData.totalLiabilities.toLocaleString('fa-IR') %></strong></td>
                            </tr>
                            
                            <tr style="height: 10px;">
                                <td colspan="2"></td>
                            </tr>
                            
                            <tr style="background: #d1ecf1;">
                                <td colspan="2"><strong>ุญููู ูุงูฺฉุงูู</strong></td>
                            </tr>
                            <tr>
                                <td>&nbsp;&nbsp;ุญููู ูุงูฺฉุงูู</td>
                                <td style="text-align: left;"><%= reportData.totalEquity.toLocaleString('fa-IR') %></td>
                            </tr>
                            <tr>
                                <td>&nbsp;&nbsp;ุณูุฏ ุณุงู ุฌุงุฑ</td>
                                <td style="text-align: left;"><%= reportData.netIncome.toLocaleString('fa-IR') %></td>
                            </tr>
                            <tr style="font-weight: bold; background: #bee5eb;">
                                <td><strong>ุฌูุน ุญููู ูุงูฺฉุงูู</strong></td>
                                <td style="text-align: left;"><strong><%= (reportData.totalEquity + reportData.netIncome).toLocaleString('fa-IR') %></strong></td>
                            </tr>
                            
                            <tr style="font-weight: bold; background: #17a2b8; color: white;">
                                <td><strong>ูุฌููุน ุจุฏูโูุง ู ุญููู</strong></td>
                                <td style="text-align: left;"><strong><%= (reportData.totalLiabilities + reportData.totalEquity + reportData.netIncome).toLocaleString('fa-IR') %></strong></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Cash Flow Statement -->
<div id="cash-flow-report" class="report-section" style="display: none;">
    <div class="card">
        <div class="card-header">
            ๐ฐ ุตูุฑุช ุฌุฑุงู ูุฌู ููุฏ
            <span class="float-left">ุจุฑุง ุณุงู ููุชู ุจู 1403/09/30</span>
        </div>
        <div class="card-body">
            <div class="table-responsive">
                <table class="table table-bordered">
                    <thead style="background: #f8f9fa;">
                        <tr>
                            <th>ุดุฑุญ</th>
                            <th style="text-align: left; width: 200px;">ูุจูุบ (ุฑุงู)</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr style="background: #d4edda;">
                            <td colspan="2"><strong>ุฌุฑุงู ูุฌู ููุฏ ุงุฒ ูุนุงูุชโูุง ุนููุงุช</strong></td>
                        </tr>
                        <tr>
                            <td>&nbsp;&nbsp;ูุฌู ููุฏ ุฏุฑุงูุช ุงุฒ ูุดุชุฑุงู</td>
                            <td style="text-align: left;"><%= reportData.cashInflows.toLocaleString('fa-IR') %></td>
                        </tr>
                        <tr>
                            <td>&nbsp;&nbsp;ูุฌู ููุฏ ูพุฑุฏุงุฎุช ุจุงุจุช ูุฒููโูุง</td>
                            <td style="text-align: left;">(<%= reportData.cashOutflows.toLocaleString('fa-IR') %>)</td>
                        </tr>
                        <tr style="font-weight: bold; background: #c3e6cb;">
                            <td><strong>ุฎุงูุต ูุฌู ููุฏ ุญุงุตู ุงุฒ ูุนุงูุชโูุง ุนููุงุช</strong></td>
                            <td style="text-align: left;"><strong><%= reportData.netCashFlow.toLocaleString('fa-IR') %></strong></td>
                        </tr>
                        
                        <tr style="height: 10px;">
                            <td colspan="2"></td>
                        </tr>
                        
                        <tr style="background: #d1ecf1;">
                            <td colspan="2"><strong>ุฌุฑุงู ูุฌู ููุฏ ุงุฒ ูุนุงูุชโูุง ุณุฑูุงูโฺฏุฐุงุฑ</strong></td>
                        </tr>
                        <tr>
                            <td>&nbsp;&nbsp;ุฎุฑุฏ ุชุฌูุฒุงุช</td>
                            <td style="text-align: left;">(15,000,000)</td>
                        </tr>
                        <tr style="font-weight: bold; background: #b8daff;">
                            <td><strong>ุฎุงูุต ูุฌู ููุฏ ูุตุฑู ุดุฏู ุฏุฑ ูุนุงูุชโูุง ุณุฑูุงูโฺฏุฐุงุฑ</strong></td>
                            <td style="text-align: left;"><strong>(15,000,000)</strong></td>
                        </tr>
                        
                        <tr style="height: 10px;">
                            <td colspan="2"></td>
                        </tr>
                        
                        <tr style="background: #fff3cd;">
                            <td colspan="2"><strong>ุฌุฑุงู ูุฌู ููุฏ ุงุฒ ูุนุงูุชโูุง ุชุฃูู ูุงู</strong></td>
                        </tr>
                        <tr>
                            <td>&nbsp;&nbsp;ุจุฑุฏุงุดุช ุณุฑูุงู</td>
                            <td style="text-align: left;">(10,000,000)</td>
                        </tr>
                        <tr style="font-weight: bold; background: #ffeaa7;">
                            <td><strong>ุฎุงูุต ูุฌู ููุฏ ูุตุฑู ุดุฏู ุฏุฑ ูุนุงูุชโูุง ุชุฃูู ูุงู</strong></td>
                            <td style="text-align: left;"><strong>(10,000,000)</strong></td>
                        </tr>
                        
                        <tr style="height: 10px;">
                            <td colspan="2"></td>
                        </tr>
                        
                        <tr style="font-weight: bold; background: #007bff; color: white;">
                            <td><strong>ุฎุงูุต ุชุบุฑ ุฏุฑ ูุฌู ููุฏ</strong></td>
                            <td style="text-align: left;"><strong>(6,000,000)</strong></td>
                        </tr>
                        <tr>
                            <td>ูุฌู ููุฏ ุงุจุชุฏุง ุณุงู</td>
                            <td style="text-align: left;">131,000,000</td>
                        </tr>
                        <tr style="font-weight: bold; background: #28a745; color: white;">
                            <td><strong>ูุฌู ููุฏ ุงูุชูุง ุณุงู</strong></td>
                            <td style="text-align: left;"><strong>125,000,000</strong></td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<!-- Financial Analysis -->
<div id="financial-analysis-report" class="report-section" style="display: none;">
    <div class="card">
        <div class="card-header">
            ๐ ุชุญูู ูุงู ู ูุณุจุชโูุง ฺฉูุฏ
        </div>
        <div class="card-body">
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">
                <!-- Profitability Ratios -->
                <div style="background: #e8f5e8; padding: 20px; border-radius: 8px;">
                    <h6 style="color: #28a745; margin-bottom: 15px;">๐ฐ ูุณุจุชโูุง ุณูุฏุขูุฑ</h6>
                    <table class="table table-sm">
                        <tr>
                            <td>ุญุงุดู ุณูุฏ ุฎุงูุต:</td>
                            <td class="text-left"><strong><%= reportData.profitMargin %>%</strong></td>
                        </tr>
                        <tr>
                            <td>ฺฏุฑุฏุด ุฏุงุฑุงโูุง:</td>
                            <td class="text-left"><strong><%= reportData.assetTurnover %></strong></td>
                        </tr>
                        <tr>
                            <td>ูุณุจุช ุจุฏู:</td>
                            <td class="text-left"><strong><%= reportData.debtRatio %>%</strong></td>
                        </tr>
                    </table>
                </div>
                
                <!-- Liquidity Ratios -->
                <div style="background: #e3f2fd; padding: 20px; border-radius: 8px;">
                    <h6 style="color: #2196f3; margin-bottom: 15px;">๐ง ูุณุจุชโูุง ููุฏูฺฏ</h6>
                    <table class="table table-sm">
                        <tr>
                            <td>ูุณุจุช ุฌุงุฑ:</td>
                            <td class="text-left"><strong><%= reportData.currentRatio %></strong></td>
                        </tr>
                        <tr>
                            <td>ูุฌููุน ุฏุงุฑุงโูุง:</td>
                            <td class="text-left"><strong><%= reportData.totalAssets.toLocaleString('fa-IR') %></strong></td>
                        </tr>
                        <tr>
                            <td>ููุฌูุฏ ููุฏ:</td>
                            <td class="text-left"><strong><%= reportData.cashBalance.toLocaleString('fa-IR') %></strong></td>
                        </tr>
                    </table>
                </div>
                
                <!-- Efficiency Ratios -->
                <div style="background: #fff3e0; padding: 20px; border-radius: 8px;">
                    <h6 style="color: #ff9800; margin-bottom: 15px;">โก ูุณุจุชโูุง ฺฉุงุฑุง</h6>
                    <table class="table table-sm">
                        <tr>
                            <td>ฺฏุฑุฏุด ุฏุงุฑุงโูุง:</td>
                            <td class="text-left"><strong>1.7 ุจุงุฑ</strong></td>
                        </tr>
                        <tr>
                            <td>ฺฏุฑุฏุด ููุฌูุฏ:</td>
                            <td class="text-left"><strong>3.3 ุจุงุฑ</strong></td>
                        </tr>
                        <tr>
                            <td>ูุชูุณุท ูุตูู ูุทุงูุจุงุช:</td>
                            <td class="text-left"><strong>21 ุฑูุฒ</strong></td>
                        </tr>
                        <tr>
                            <td>ฺุฑุฎู ููุฏ:</td>
                            <td class="text-left"><strong>110 ุฑูุฒ</strong></td>
                        </tr>
                    </table>
                </div>
                
                <!-- Leverage Ratios -->
                <div style="background: #fce4ec; padding: 20px; border-radius: 8px;">
                    <h6 style="color: #e91e63; margin-bottom: 15px;">๐ ูุณุจุชโูุง ุงูุฑู</h6>
                    <table class="table table-sm">
                        <tr>
                            <td>ูุณุจุช ุจุฏู ุจู ุฏุงุฑุง:</td>
                            <td class="text-left"><strong>11%</strong></td>
                        </tr>
                        <tr>
                            <td>ูุณุจุช ุจุฏู ุจู ุญููู:</td>
                            <td class="text-left"><strong>12%</strong></td>
                        </tr>
                        <tr>
                            <td>ุถุฑุจ ุญููู ูุงูฺฉุงูู:</td>
                            <td class="text-left"><strong>89%</strong></td>
                        </tr>
                        <tr>
                            <td>ูพูุดุด ุจูุฑู:</td>
                            <td class="text-left"><strong>-</strong></td>
                        </tr>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Quick Actions -->
<div class="card">
    <div class="card-header">
        ุนููุงุช
    </div>
    <div class="card-body">
        <div style="display: flex; gap: 10px; flex-wrap: wrap;">
            <a href="/accounting" class="btn btn-secondary">ุจุงุฒฺฏุดุช ุจู ุญุณุงุจุฏุงุฑ</a>
            <a href="/accounting/trial-balance" class="btn btn-info">ุชุฑุงุฒ ุขุฒูุงุด</a>
            <a href="/accounting/journal-entries" class="btn btn-primary">ุฏูุชุฑ ุฑูุฒูุงูู</a>
            <button onclick="window.print()" class="btn btn-outline-primary">ฺุงูพ</button>
        </div>
    </div>
</div>

<script>
// Helper function to safely format numbers
function formatNumber(num) {
    if (typeof num === 'undefined' || num === null || isNaN(num)) {
        return '0';
    }
    return Number(num).toLocaleString('fa-IR');
}

function showReport(reportType) {
    // Hide all reports
    document.querySelectorAll('.report-section').forEach(section => {
        section.style.display = 'none';
    });
    
    // Reset all button styles
    document.querySelectorAll('button[id^="btn-"]').forEach(btn => {
        btn.className = btn.className.replace('btn-primary', 'btn-outline-primary')
                                   .replace('btn-success', 'btn-outline-success')
                                   .replace('btn-info', 'btn-outline-info')
                                   .replace('btn-warning', 'btn-outline-warning');
    });
    
    // Show selected report
    const reportElement = document.getElementById(reportType + '-report');
    if (reportElement) {
        reportElement.style.display = 'block';
    }
    
    // Highlight selected button
    const buttonElement = document.getElementById('btn-' + reportType);
    if (buttonElement) {
        if (reportType === 'profit-loss') {
            buttonElement.className = buttonElement.className.replace('btn-outline-primary', 'btn-primary');
        } else if (reportType === 'balance-sheet') {
            buttonElement.className = buttonElement.className.replace('btn-outline-success', 'btn-success');
        } else if (reportType === 'cash-flow') {
            buttonElement.className = buttonElement.className.replace('btn-outline-info', 'btn-info');
        } else if (reportType === 'financial-analysis') {
            buttonElement.className = buttonElement.className.replace('btn-outline-warning', 'btn-warning');
        }
    }
}

function exportToPDF() {
    alert('ุฎุฑูุฌ PDF - ุงู ูุงุจูุช ุจู ุฒูุฏ ุงุถุงูู ูโุดูุฏ');
}

// Show profit & loss by default
document.addEventListener('DOMContentLoaded', function() {
    showReport('profit-loss');
});
</script> 