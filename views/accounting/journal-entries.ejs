<div class="page-header">
    <h1 class="page-title">Ø¯ÙØªØ± Ø±ÙˆØ²Ù†Ø§Ù…Ù‡</h1>
    <p>Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ú©Ù„ÛŒÙ‡ Ù‚ÛŒÙˆØ¯ Ø­Ø³Ø§Ø¨Ø¯Ø§Ø±ÛŒ Ø¨Ù‡ ØªØ±ØªÛŒØ¨ Ø²Ù…Ø§Ù†ÛŒ</p>
</div>

<!-- Statistics -->
<div class="stats-grid" style="grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));">
    <div class="stat-card">
        <div class="stat-number"><%= journalEntries ? journalEntries.length : 0 %></div>
        <div class="stat-label">ØªØ¹Ø¯Ø§Ø¯ Ù‚ÛŒÙˆØ¯</div>
        <div class="stat-icon" style="color: #6f42c1;">ğŸ“‹</div>
    </div>
    
    <div class="stat-card">
        <div class="stat-number">
            <%= journalEntries ? new Intl.NumberFormat('fa-IR').format(
                journalEntries.reduce((sum, entry) => sum + parseFloat(entry.total_debit || 0), 0)
            ) : 0 %>
        </div>
        <div class="stat-label">Ù…Ø¬Ù…ÙˆØ¹ Ø¨Ø¯Ù‡Ú©Ø§Ø± (Ø±ÛŒØ§Ù„)</div>
        <div class="stat-icon" style="color: #28a745;">â•</div>
    </div>
    
    <div class="stat-card">
        <div class="stat-number">
            <%= journalEntries ? new Intl.NumberFormat('fa-IR').format(
                journalEntries.reduce((sum, entry) => sum + parseFloat(entry.total_credit || 0), 0)
            ) : 0 %>
        </div>
        <div class="stat-label">Ù…Ø¬Ù…ÙˆØ¹ Ø¨Ø³ØªØ§Ù†Ú©Ø§Ø± (Ø±ÛŒØ§Ù„)</div>
        <div class="stat-icon" style="color: #dc3545;">â–</div>
    </div>
    
    <div class="stat-card">
        <div class="stat-number">
            <%= journalEntries ? journalEntries.filter(entry => {
                const entryDate = new Date(entry.entry_date);
                const today = new Date();
                return entryDate.toDateString() === today.toDateString();
            }).length : 0 %>
        </div>
        <div class="stat-label">ØªØ±Ø§Ú©Ù†Ø´â€ŒÙ‡Ø§ÛŒ Ø§Ù…Ø±ÙˆØ²</div>
        <div class="stat-icon" style="color: #17a2b8;">ğŸ“…</div>
    </div>
</div>

<!-- Journal Entries Table -->
<div class="card">
    <div class="card-header">
        Ù‚ÛŒÙˆØ¯ Ø­Ø³Ø§Ø¨Ø¯Ø§Ø±ÛŒ
        <a href="/accounting/manual-transaction" class="btn btn-success btn-sm float-left">
            â• Ø«Ø¨Øª Ù‚ÛŒØ¯ Ø¯Ø³ØªÛŒ
        </a>
    </div>
    <div class="card-body">
        <div class="table-responsive">
            <table class="table table-hover">
                <thead style="background: #f8f9fa;">
                    <tr>
                        <th>Ø´Ù…Ø§Ø±Ù‡ Ù‚ÛŒØ¯</th>
                        <th>ØªØ§Ø±ÛŒØ®</th>
                        <th>Ø´Ø±Ø­</th>
                        <th>Ù†ÙˆØ¹ ØªØ±Ø§Ú©Ù†Ø´</th>
                        <th style="text-align: left;">Ø¨Ø¯Ù‡Ú©Ø§Ø± (Ø±ÛŒØ§Ù„)</th>
                        <th style="text-align: left;">Ø¨Ø³ØªØ§Ù†Ú©Ø§Ø± (Ø±ÛŒØ§Ù„)</th>
                        <th>Ø¹Ù…Ù„ÛŒØ§Øª</th>
                    </tr>
                </thead>
                <tbody>
                    <% if (journalEntries && journalEntries.length > 0) { %>
                        <% journalEntries.forEach((entry, index) => { %>
                            <tr style="border-top: 3px solid #007bff; background: #f0f7ff;">
                                <td rowspan="1" style="vertical-align: middle; text-align: center;">
                                    <strong><%= entry.entry_number %></strong>
                                </td>
                                <td rowspan="1" style="vertical-align: middle;">
                                    <%= new Date(entry.entry_date).toLocaleDateString('fa-IR') %><br>
                                    <small class="text-muted">
                                        <%= new Date(entry.created_at).toLocaleTimeString('fa-IR', {hour: '2-digit', minute: '2-digit'}) %>
                                    </small>
                                </td>
                                <td rowspan="1" style="vertical-align: middle;">
                                    <strong><%= entry.description %></strong><br>
                                    <small class="text-muted">
                                        <%= entry.transaction_type_persian %> 
                                        <% if (entry.party_name) { %>
                                            - <strong><%= entry.party_name %></strong>
                                        <% } %>
                                        <% if (entry.payment_method) { %>
                                            <br>Ø±ÙˆØ´ Ù¾Ø±Ø¯Ø§Ø®Øª: <%= entry.payment_method === 'cash' ? 'Ù†Ù‚Ø¯' : entry.payment_method === 'card' ? 'Ú©Ø§Ø±Øª' : entry.payment_method === 'transfer' ? 'Ø­ÙˆØ§Ù„Ù‡' : entry.payment_method %>
                                        <% } %>
                                        <% if (entry.reference_number) { %>
                                            <br>Ø´Ù…Ø§Ø±Ù‡ Ù…Ø±Ø¬Ø¹: <%= entry.reference_number %>
                                        <% } %>
                                    </small>
                                </td>
                                <!-- Transaction Details -->
                                <td>
                                    <span class="badge badge-primary">
                                        <%= entry.transaction_type_persian %>
                                    </span>
                                </td>
                                <td style="text-align: left; font-weight: bold; color: #28a745;">
                                    <%= new Intl.NumberFormat('fa-IR').format(entry.total_debit || 0) %>
                                </td>
                                <td style="text-align: left; font-weight: bold; color: #dc3545;">
                                    <%= new Intl.NumberFormat('fa-IR').format(entry.total_credit || 0) %>
                                </td>
                                <td>
                                    <span class="badge badge-info"><%= entry.transaction_type_persian %></span>
                                </td>
                                <td rowspan="1" style="vertical-align: middle;">
                                    <div class="btn-group btn-group-sm">
                                        <a href="/accounting/transactions/<%= entry.reference_id %>" 
                                           class="btn btn-outline-primary btn-sm" title="Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ø¬Ø²Ø¦ÛŒØ§Øª">
                                            ğŸ‘
                                        </a>
                                        <button onclick="deleteTransaction(<%= entry.reference_id %>)" 
                                                class="btn btn-outline-danger btn-sm" title="Ø­Ø°Ù">
                                            ğŸ—‘
                                        </button>
                                    </div>
                                </td>
                            </tr>
                        <% }); %>
                    <% } else { %>
                        <tr>
                            <td colspan="8" class="text-center text-muted" style="padding: 50px;">
                                <i class="fas fa-inbox fa-3x"></i><br><br>
                                <h5>Ù‡Ù†ÙˆØ² Ù‚ÛŒØ¯ÛŒ Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª</h5>
                                <p>Ø¨Ø±Ø§ÛŒ Ø´Ø±ÙˆØ¹ØŒ Ø§ÙˆÙ„ÛŒÙ† ØªØ±Ø§Ú©Ù†Ø´ Ø®ÙˆØ¯ Ø±Ø§ Ø«Ø¨Øª Ú©Ù†ÛŒØ¯</p>
                                <a href="/accounting/manual-transaction" class="btn btn-primary">
                                    <i class="fas fa-plus"></i> Ø«Ø¨Øª Ø§ÙˆÙ„ÛŒÙ† ØªØ±Ø§Ú©Ù†Ø´
                                </a>
                            </td>
                        </tr>
                    <% } %>
                </tbody>
            </table>
        </div>
    </div>
</div>

<!-- Quick Actions -->
<div class="card">
    <div class="card-header">
        Ø¹Ù…Ù„ÛŒØ§Øª
    </div>
    <div class="card-body">
        <div style="display: flex; gap: 10px; flex-wrap: wrap;">
            <a href="/accounting" class="btn btn-secondary">Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ù‡ Ø­Ø³Ø§Ø¨Ø¯Ø§Ø±ÛŒ</a>
            <a href="/accounting/manual-transaction" class="btn btn-success">Ø«Ø¨Øª Ù‚ÛŒØ¯ Ø¯Ø³ØªÛŒ</a>
            <a href="/accounting/trial-balance" class="btn btn-info">ØªØ±Ø§Ø² Ø¢Ø²Ù…Ø§ÛŒØ´ÛŒ</a>
            <a href="/accounting/chart-of-accounts" class="btn btn-primary">Ø¨Ù‡Ø§Ø± Ø­Ø³Ø§Ø¨â€ŒÙ‡Ø§</a>
            <button onclick="window.print()" class="btn btn-outline-primary">Ú†Ø§Ù¾</button>
        </div>
    </div>
</div> 

<script>
function deleteTransaction(transactionId) {
    if (confirm('Ø¢ÛŒØ§ Ø§Ø² Ø­Ø°Ù Ø§ÛŒÙ† ØªØ±Ø§Ú©Ù†Ø´ Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ØŸ\nØªÙˆØ¬Ù‡: ØªÙ…Ø§Ù… ØªØ£Ø«ÛŒØ±Ø§Øª Ø­Ø³Ø§Ø¨Ø¯Ø§Ø±ÛŒ Ø¢Ù† Ø¨Ø±Ú¯Ø±Ø¯Ø§Ù†Ø¯Ù‡ Ø®ÙˆØ§Ù‡Ø¯ Ø´Ø¯.')) {
        // Create form and submit
        const form = document.createElement('form');
        form.method = 'POST';
        form.action = `/accounting/transactions/${transactionId}/delete`;
        form.style.display = 'none';
        document.body.appendChild(form);
        form.submit();
    }
}

function printPage() {
    window.print();
}

// Filter functionality
function filterEntries() {
    const startDate = document.getElementById('startDate').value;
    const endDate = document.getElementById('endDate').value;
    const referenceType = document.getElementById('referenceType').value;
    
    const params = new URLSearchParams();
    if (startDate) params.append('startDate', startDate);
    if (endDate) params.append('endDate', endDate);
    if (referenceType && referenceType !== 'all') params.append('reference_type', referenceType);
    
    window.location.href = '/accounting/journal-entries?' + params.toString();
}
</script> 