╔══════════════════════════════════════════════════════════════╗
║          VPS AUTO-RESTART - QUICK REFERENCE CARD             ║
╚══════════════════════════════════════════════════════════════╝

✅ YOUR SETUP IS ALREADY CONFIGURED FOR AUTO-RESTART!

┌──────────────────────────────────────────────────────────────┐
│ WHAT'S ALREADY WORKING:                                      │
├──────────────────────────────────────────────────────────────┤
│ ✅ All services have "restart: unless-stopped"              │
│ ✅ MySQL auto-restarts on crash or reboot                   │
│ ✅ App auto-restarts on crash or reboot                     │
│ ✅ Nginx auto-restarts on crash or reboot                   │
│ ✅ Certbot auto-restarts on crash or reboot                 │
└──────────────────────────────────────────────────────────────┘

┌──────────────────────────────────────────────────────────────┐
│ ON YOUR VPS (ONE-TIME SETUP):                                │
├──────────────────────────────────────────────────────────────┤
│ 1. Upload vps-enable-autorestart.sh to VPS                  │
│ 2. Run: sudo ./vps-enable-autorestart.sh                    │
│ 3. Deploy: docker compose up -d                             │
│ 4. Done! Reboot VPS to test                                 │
└──────────────────────────────────────────────────────────────┘

┌──────────────────────────────────────────────────────────────┐
│ MANUAL COMMANDS (if needed):                                 │
├──────────────────────────────────────────────────────────────┤
│ Enable Docker on boot:                                       │
│   $ sudo systemctl enable docker                             │
│                                                               │
│ Check Docker status:                                         │
│   $ sudo systemctl status docker                             │
│                                                               │
│ Check containers after reboot:                               │
│   $ docker ps                                                │
│                                                               │
│ Manual start (if needed):                                    │
│   $ cd /opt/moosapoor                                        │
│   $ docker compose up -d                                     │
└──────────────────────────────────────────────────────────────┘

┌──────────────────────────────────────────────────────────────┐
│ WHAT HAPPENS WHEN VPS REBOOTS:                              │
├──────────────────────────────────────────────────────────────┤
│ 1. VPS boots up                                              │
│ 2. Docker service starts automatically                       │
│ 3. Docker reads docker-compose.yml                           │
│ 4. MySQL starts and waits to be healthy                      │
│ 5. App starts after MySQL is healthy                         │
│ 6. Nginx starts after App is healthy                         │
│ 7. Certbot starts for SSL renewal                            │
│ 8. Website is online at https://mosaporgold.ir              │
│                                                               │
│ Total time: ~2-3 minutes after VPS boot                      │
└──────────────────────────────────────────────────────────────┘

┌──────────────────────────────────────────────────────────────┐
│ MONITORING:                                                   │
├──────────────────────────────────────────────────────────────┤
│ Check container status:                                       │
│   $ docker ps                                                │
│                                                               │
│ Check restart count:                                          │
│   $ docker inspect goldshop_app | grep -A 3 RestartPolicy   │
│                                                               │
│ View container logs:                                          │
│   $ docker logs goldshop_app --tail 50                       │
│   $ docker logs goldshop_mysql --tail 50                     │
│                                                               │
│ Check website:                                                │
│   $ curl -I https://mosaporgold.ir                           │
│                                                               │
│ View health check logs:                                       │
│   $ tail -f /var/log/docker-health.log                       │
└──────────────────────────────────────────────────────────────┘

┌──────────────────────────────────────────────────────────────┐
│ RESTART POLICIES EXPLAINED:                                  │
├──────────────────────────────────────────────────────────────┤
│ restart: unless-stopped (YOUR SETUP)                         │
│   ✅ Restarts on container crash                            │
│   ✅ Restarts on VPS reboot                                 │
│   ⚠️  Won't restart if manually stopped (docker stop)       │
│                                                               │
│ restart: always (alternative)                                │
│   ✅ Restarts on container crash                            │
│   ✅ Restarts on VPS reboot                                 │
│   ✅ Restarts even if manually stopped                      │
│                                                               │
│ restart: on-failure (not recommended)                        │
│   ✅ Only restarts if container exits with error            │
│   ❌ Won't restart on VPS reboot if stopped cleanly         │
│                                                               │
│ restart: no (default, not recommended)                       │
│   ❌ Never restarts automatically                           │
└──────────────────────────────────────────────────────────────┘

┌──────────────────────────────────────────────────────────────┐
│ TROUBLESHOOTING:                                             │
├──────────────────────────────────────────────────────────────┤
│ Containers not running after reboot?                         │
│   1. Check: sudo systemctl status docker                     │
│   2. Enable: sudo systemctl enable docker                    │
│   3. Start: docker compose up -d                             │
│                                                               │
│ One container keeps restarting?                              │
│   1. Check logs: docker logs <container_name> --tail 100     │
│   2. Check health: docker inspect <container_name>           │
│   3. Restart manually: docker compose restart <service>      │
│                                                               │
│ Website not accessible after reboot?                         │
│   1. Wait 3-5 minutes (containers need time to start)        │
│   2. Check: docker ps (all should show "Up X minutes")       │
│   3. Check Nginx: docker logs goldshop_nginx                 │
│   4. Check firewall: sudo ufw status                         │
└──────────────────────────────────────────────────────────────┘

┌──────────────────────────────────────────────────────────────┐
│ FILES INCLUDED:                                              │
├──────────────────────────────────────────────────────────────┤
│ 📄 docker-compose.yml                                        │
│    → Contains restart: unless-stopped for all services       │
│                                                               │
│ 📄 vps-enable-autorestart.sh                                │
│    → One-time setup script for VPS                           │
│                                                               │
│ 📄 VPS_AUTO_RESTART_GUIDE.md                                │
│    → Complete documentation                                  │
│                                                               │
│ 📄 AUTO_RESTART_QUICK_REFERENCE.txt                         │
│    → This file                                               │
└──────────────────────────────────────────────────────────────┘

┌──────────────────────────────────────────────────────────────┐
│ TEST CHECKLIST:                                              │
├──────────────────────────────────────────────────────────────┤
│ Before VPS reboot:                                           │
│   □ All containers running: docker ps                        │
│   □ Website accessible: curl https://mosaporgold.ir         │
│   □ Docker enabled: systemctl is-enabled docker             │
│                                                               │
│ After VPS reboot (wait 3 minutes):                          │
│   □ SSH back in: ssh root@45.156.186.85                     │
│   □ Check Docker: systemctl status docker                   │
│   □ Check containers: docker ps                             │
│   □ Check website: curl -I https://mosaporgold.ir           │
│   □ Login and test: visit website and login                 │
└──────────────────────────────────────────────────────────────┘

╔══════════════════════════════════════════════════════════════╗
║  🎉 YOUR SYSTEM WILL AUTOMATICALLY RESTART AFTER REBOOT! 🎉  ║
╚══════════════════════════════════════════════════════════════╝

Support: Read VPS_AUTO_RESTART_GUIDE.md for detailed info
